<!DOCTYPE html>
<html lang="en"><head>
<script src="05_basicmodels_files/libs/clipboard/clipboard.min.js"></script>
<script src="05_basicmodels_files/libs/quarto-html/tabby.min.js"></script>
<script src="05_basicmodels_files/libs/quarto-html/popper.min.js"></script>
<script src="05_basicmodels_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="05_basicmodels_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="05_basicmodels_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="05_basicmodels_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="05_basicmodels_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="author" content="David Rossell">
  <title>Modern Statistical Computing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="05_basicmodels_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="05_basicmodels_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="05_basicmodels_files/libs/revealjs/dist/theme/quarto.css">
  <link href="05_basicmodels_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="05_basicmodels_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="05_basicmodels_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="05_basicmodels_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Modern Statistical Computing</h1>
  <p class="subtitle">5. Basic models</p>
  <p class="author">David Rossell</p>
  <p class="institute">Pompeu Fabra University</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/linear-models" id="/toc-linear-models">Linear models</a></li>
<li><a href="#/extracting-inference" id="/toc-extracting-inference">Extracting inference</a></li>
<li><a href="#/residual-analysis" id="/toc-residual-analysis">Residual analysis</a></li>
<li><a href="#/exercise" id="/toc-exercise">Exercise</a></li>
<li><a href="#/interpreting-the-coefficients" id="/toc-interpreting-the-coefficients">Interpreting the coefficients</a></li>
<li><a href="#/linear-contrasts" id="/toc-linear-contrasts">Linear contrasts</a></li>
<li><a href="#/interactions" id="/toc-interactions">Interactions</a></li>
<li><a href="#/nested-models" id="/toc-nested-models">Nested models</a></li>
<li><a href="#/summary-of-useful-functions" id="/toc-summary-of-useful-functions">Summary of useful functions</a></li>
<li><a href="#/exercise-1" id="/toc-exercise-1">Exercise</a></li>
</ul>
</nav>
</section>
<section id="reproducing-these-lecture-notes" class="slide level2">
<h2>Reproducing these lecture notes</h2>
<p>Load the required R packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coefplot)</span>
<span id="cb1-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb1-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hexbin)</span>
<span id="cb1-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb1-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb1-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also load auxiliary routines stored at <code>routines.R</code> (directory <code>code</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'../code/routines.R'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also source files from RStudio (<code>Code -&gt; Source File</code>)</p>
</section>
<section id="models" class="slide level2">
<h2>Models</h2>
<p>George Box’s famous mantra</p>
<blockquote>
<p>All models are wrong, but some are useful</p>
</blockquote>
<p>Its less well-known context</p>
<blockquote>
<p>Now it would be very remarkable if any system existing in the real world could be exactly represented by any simple model. However, cunningly chosen parsimonious models often do provide remarkably useful approximations. For example, the law PV = RT relating pressure P, volume V and temperature T of an “ideal” gas via a constant R is not exactly true for any real gas, but it frequently provides a useful approximation and furthermore its structure is informative since it springs from a physical view of the behavior of gas molecules.</p>
</blockquote>
<blockquote>
<p>For such a model there is no need to ask the question “Is the model true?”. If “truth” is to be the “whole truth” the answer must be “No”. The only question of interest is “Is the model illuminating and useful?”.</p>
</blockquote>
</section>
<section class="slide level2">

<p>Another quote by Box (he had many!)</p>
<blockquote>
<p>Statisticians, like artists, have the bad habit of falling in love with their models</p>
</blockquote>
<p>Meaning that it’s important to check whether the model fits the main features of the data</p>
</section>
<section>
<section id="linear-models" class="title-slide slide level1 center">
<h1>Linear models</h1>
<p>Models help interpret what’s going on in a dataset</p>
<p><span class="math display">\[
y_i = \beta_0 + \sum_{j=1}^p \beta_j x_{ij} + \epsilon_i
\]</span> where <span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span> indep <span class="math inline">\(i=1,\ldots,n\)</span></p>
<ul>
<li><p><code>lm</code> fits a linear regression by least-squares in R</p></li>
<li><p><code>glm</code> fits generalized linear models (for non-normal outcomes, e.g.&nbsp;binary)</p></li>
<li><p><code>gam</code> fits generalized additive models</p></li>
</ul>
<p><span class="math display">\[
y_i= \sum_{j=1}^p f_j(x_{ij}) + \epsilon_i \mbox{, unknown } f_j
\]</span></p>
</section>
<section id="reminder" class="slide level2">
<h2>Reminder</h2>
<p><span class="math display">\[y= \begin{pmatrix} y_1 \\ \ldots \\ y_n \end{pmatrix};
X=\begin{pmatrix}
1 &amp; x_{11} &amp; \ldots &amp; x_{1p} \\
\ldots \\
1 &amp; x_{n1} &amp; \ldots &amp; x_{np}
\end{pmatrix}=
\begin{pmatrix}
x_1^T \\
\ldots \\
x_n^T \\
\end{pmatrix}
\]</span></p>
<p>Then (assuming <span class="math inline">\(X^TX\)</span> is invertible) <span class="math display">\[\hat{\beta}= (X^T X)^{-1} X^T y= \arg\min_\beta \sum_{i=1}^n (y_i - x_i^T \beta)^2\]</span></p>
<p>Further, if the model assumptions hold</p>
<p><span class="math display">\[\hat{\beta} \sim N(\beta, V); V= \sigma^2 (X^T X)^{-1}\]</span> Which gives confidence intervals and P-values, e.g. <span class="math inline">\(\hat{\beta}_j \pm 1.96 \sqrt{v_{jj}}\)</span></p>
</section>
<section id="reminder-1" class="slide level2">
<h2>Reminder</h2>
<p>Sometimes we’re interested in linear combinations of parameters</p>
<p><strong>Result.</strong> Let <span class="math inline">\(Z \sim N(\mu, V)\)</span> be a <span class="math inline">\(p\)</span>-dimensional Normal distribution, and <span class="math inline">\(C\)</span> a <span class="math inline">\(q \times p\)</span> matrix with full rank <span class="math inline">\(q \leq p\)</span>. Then <span class="math display">\[
W= C Z \sim N(C \mu, C V C^T)
\]</span> is a <span class="math inline">\(q\)</span>-dimensional normal</p>
<p><strong>Example.</strong> We seek a 95% CI for <span class="math inline">\(\beta_2 - \beta_1\)</span>. Let <span class="math inline">\(C= \begin{pmatrix}
-1 &amp; 1 &amp; 0 &amp; \ldots &amp; 0 \\
\end{pmatrix}\)</span> Then <span class="math display">\[C \begin{pmatrix} \hat{\beta}_1 \\ \hat{\beta}_2 \\ \ldots \\ \hat{\beta}_p \end{pmatrix} = \hat{\beta}_2 - \hat{\beta}_1 \sim N(\beta_2 - \beta_1, \sigma^2 C (X^T X)^{-1} C^T)\]</span></p>
</section>
<section id="example.-diamonds-data" class="slide level2">
<h2>Example. Diamonds data</h2>
<p>What drives diamond prices? Exploration suggests that low-quality diamonds are more expensive (worst diamond color is J (yellow-ish), worst clarity is l1)</p>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Price vs.&nbsp;cut</a></li><li><a href="#tabset-1-2">Price vs.&nbsp;color</a></li><li><a href="#tabset-1-3">Price vs.&nbsp;clarity</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-3-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color, price)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-4-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(clarity, price)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-5-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="diagnosing-the-issue" class="slide level2">
<h2>Diagnosing the issue</h2>
<p>Price is strongly associated with carats (diamond weight)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-6-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Carats also associated with cut, color and clarity</p>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Carats vs.&nbsp;cut</a></li><li><a href="#tabset-2-2">Carats vs.&nbsp;color</a></li><li><a href="#tabset-2-3">Carats vs.&nbsp;clarity</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, carat)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-7-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color, carat)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-8-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(clarity, carat)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-9-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>The most important assumption in a linear model: <strong>linearity!</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="" aria-hidden="true" tabindex="-1"></a>diamonds2<span class="ot">=</span> <span class="fu">mutate</span>(diamonds, <span class="at">lprice=</span><span class="fu">log2</span>(price), <span class="at">lcarat=</span><span class="fu">log2</span>(carat))</span>
<span id="cb10-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(lcarat, lprice)) <span class="sc">+</span> </span>
<span id="cb10-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-10-1.png" width="960" class="r-stretch"><p>log2 facilitates interpretation (+1 in log2 scale <span class="math inline">\(\Rightarrow \times 2\)</span> in original scale)</p>
</section>
<section class="slide level2">

<p>Fit linear model and save residuals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmfit<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat, <span class="at">data =</span> diamonds2)</span>
<span id="cb11-2"><a href="" aria-hidden="true" tabindex="-1"></a>diamonds2<span class="ot">=</span> <span class="fu">mutate</span>(diamonds2, <span class="at">res=</span> <span class="fu">residuals</span>(lmfit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recall that worst diamond color is J (yellow-ish), worst clarity is l1</p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Residuals vs.&nbsp;cut</a></li><li><a href="#tabset-3-2">Residuals vs.&nbsp;color</a></li><li><a href="#tabset-3-3">Residuals vs.&nbsp;clarity</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(cut, res)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-12-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(color, res)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-13-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(clarity, res)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-14-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="fitting-the-full-model" class="slide level2">
<h2>Fitting the full model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmfit2<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity, <span class="at">data=</span>diamonds2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Second model has better <span class="math inline">\(R^2\)</span> coefficient. Careful though, comparison not fully reliable due to over-fitting (to be discussed)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmfit)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9329893</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmfit2)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9826161</code></pre>
</div>
</div>
<p>Many statistically signif. coefficients in 2nd model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmfit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lprice ~ lcarat + cut + color + clarity, data = diamonds2)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.45867 -0.12459 -0.00033  0.12033  2.81005 

Coefficients:
             Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept) 12.200915   0.001685 7242.225  &lt; 2e-16 ***
lcarat       1.883718   0.001129 1668.750  &lt; 2e-16 ***
cut.L        0.174154   0.003396   51.284  &lt; 2e-16 ***
cut.Q       -0.050660   0.002989  -16.950  &lt; 2e-16 ***
cut.C        0.019446   0.002595    7.494 6.77e-14 ***
cut^4       -0.002253   0.002079   -1.084    0.278    
color.L     -0.634174   0.002925 -216.828  &lt; 2e-16 ***
color.Q     -0.137955   0.002687  -51.335  &lt; 2e-16 ***
color.C     -0.021328   0.002515   -8.481  &lt; 2e-16 ***
color^4      0.017098   0.002310    7.403 1.35e-13 ***
color^5     -0.003176   0.002182   -1.455    0.146    
color^6      0.003450   0.001984    1.739    0.082 .  
clarity.L    1.322709   0.005161  256.274  &lt; 2e-16 ***
clarity.Q   -0.350630   0.004804  -72.982  &lt; 2e-16 ***
clarity.C    0.191013   0.004118   46.387  &lt; 2e-16 ***
clarity^4   -0.095368   0.003294  -28.955  &lt; 2e-16 ***
clarity^5    0.039556   0.002689   14.711  &lt; 2e-16 ***
clarity^6   -0.002624   0.002342   -1.120    0.263    
clarity^7    0.048375   0.002066   23.412  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.193 on 53921 degrees of freedom
Multiple R-squared:  0.9826,    Adjusted R-squared:  0.9826 
F-statistic: 1.693e+05 on 18 and 53921 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Let’s plot their predictive accuracy</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="" aria-hidden="true" tabindex="-1"></a>diamonds2<span class="ot">=</span> <span class="fu">mutate</span>(diamonds2, <span class="at">pred1=</span> <span class="fu">predict</span>(lmfit), <span class="at">pred2=</span><span class="fu">predict</span>(lmfit2), <span class="at">res2=</span> <span class="fu">residuals</span>(lmfit2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Model 1</a></li><li><a href="#tabset-4-2">Model 2</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(<span class="at">x=</span>pred1, <span class="at">y=</span>lprice)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">color=</span><span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-19-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(<span class="at">x=</span>pred2, <span class="at">y=</span>lprice)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">color=</span><span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-20-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="extracting-inference" class="title-slide slide level1 center">
<h1>Extracting inference</h1>

</section>
<section class="slide level2">

<p><code>summary</code> and <code>confint</code> give <span class="math inline">\(\hat{\beta}_j\)</span>, P-values for <span class="math inline">\(H_0:\beta_j=0\)</span> and confidence intervals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmfit2)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Estimate  Std. Error     t value      Pr(&gt;|t|)
(Intercept) 12.200914981 0.001684691 7242.225315  0.000000e+00
lcarat       1.883717549 0.001128819 1668.750482  0.000000e+00
cut.L        0.174153643 0.003395884   51.283741  0.000000e+00
cut.Q       -0.050659823 0.002988784  -16.949976  2.826672e-64
cut.C        0.019446261 0.002594847    7.494184  6.772916e-14
cut^4       -0.002252861 0.002078739   -1.083763  2.784747e-01
color.L     -0.634174007 0.002924780 -216.827951  0.000000e+00
color.Q     -0.137955445 0.002687342  -51.335276  0.000000e+00
color.C     -0.021327575 0.002514649   -8.481333  2.281798e-17
color^4      0.017098333 0.002309610    7.403125  1.349487e-13
color^5     -0.003175587 0.002182225   -1.455206  1.456182e-01
color^6      0.003449752 0.001983771    1.738987  8.204271e-02
clarity.L    1.322709392 0.005161312  256.273886  0.000000e+00
clarity.Q   -0.350630230 0.004804353  -72.981783  0.000000e+00
clarity.C    0.191012724 0.004117779   46.387318  0.000000e+00
clarity^4   -0.095368362 0.003293646  -28.955258 6.111761e-183
clarity^5    0.039556144 0.002688793   14.711486  6.769060e-49
clarity^6   -0.002623878 0.002342138   -1.120292  2.625945e-01
clarity^7    0.048375011 0.002066229   23.412223 1.286511e-120</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lmfit2, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    2.5 %       97.5 %
(Intercept) 12.1976129721 12.204216989
lcarat       1.8815050543  1.885930044
cut.L        0.1674976831  0.180809603
cut.Q       -0.0565178639 -0.044801781
cut.C        0.0143603403  0.024532182
cut^4       -0.0063272067  0.001821485
color.L     -0.6399065990 -0.628441416
color.Q     -0.1432226564 -0.132688233
color.C     -0.0262563069 -0.016398843
color^4      0.0125714787  0.021625188
color^5     -0.0074527657  0.001101593
color^6     -0.0004384544  0.007337958
clarity.L    1.3125931802  1.332825604
clarity.Q   -0.3600467999 -0.341213660
clarity.C    0.1829418441  0.199083603
clarity^4   -0.1018239339 -0.088912790
clarity^5    0.0342860877  0.044826200
clarity^6   -0.0072144877  0.001966732
clarity^7    0.0443251857  0.052424836</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Easier to define a function that summarizes any fitted model. I created function <code>coefSummary</code> (at <code>routines.R</code>) for that purpose</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="" aria-hidden="true" tabindex="-1"></a>coefSummary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (lmfit, level = 0.95, digits = 3, transform) 
{
    require(tidyverse)
    if (!inherits(lmfit, "lm")) 
        stop("lmfit must be of class lm")
    b = coef(lmfit)
    ci = confint(lmfit, level = level)
    if (!missing(transform)) {
        b = transform(b)
        ci = transform(ci)
    }
    b = round(b, digits)
    ci = round(ci, digits)
    ci = paste("(", ci[, 1], ",", ci[, 2], ")", sep = "")
    pval = round(summary(lmfit)$coef[, 4], 5)
    pval[pval &lt; 1e-05] = "&lt;0.00001"
    ans = tibble(names(b), b, ci, pval)
    names(ans) = c("Parameter", "Estimate", "Conf. Int.", "P-value")
    return(ans)
}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(lmfit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 4
   Parameter   Estimate `Conf. Int.`    `P-value`
   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    
 1 (Intercept)   12.2   (12.198,12.204) &lt;0.00001 
 2 lcarat         1.88  (1.882,1.886)   &lt;0.00001 
 3 cut.L          0.174 (0.167,0.181)   &lt;0.00001 
 4 cut.Q         -0.051 (-0.057,-0.045) &lt;0.00001 
 5 cut.C          0.019 (0.014,0.025)   &lt;0.00001 
 6 cut^4         -0.002 (-0.006,0.002)  0.27847  
 7 color.L       -0.634 (-0.64,-0.628)  &lt;0.00001 
 8 color.Q       -0.138 (-0.143,-0.133) &lt;0.00001 
 9 color.C       -0.021 (-0.026,-0.016) &lt;0.00001 
10 color^4        0.017 (0.013,0.022)   &lt;0.00001 
11 color^5       -0.003 (-0.007,0.001)  0.14562  
12 color^6        0.003 (0,0.007)       0.08204  
13 clarity.L      1.32  (1.313,1.333)   &lt;0.00001 
14 clarity.Q     -0.351 (-0.36,-0.341)  &lt;0.00001 
15 clarity.C      0.191 (0.183,0.199)   &lt;0.00001 
16 clarity^4     -0.095 (-0.102,-0.089) &lt;0.00001 
17 clarity^5      0.04  (0.034,0.045)   &lt;0.00001 
18 clarity^6     -0.003 (-0.007,0.002)  0.26259  
19 clarity^7      0.048 (0.044,0.052)   &lt;0.00001 </code></pre>
</div>
</div>
</section>
<section id="organizing-code" class="slide level2">
<h2>Organizing code</h2>
<p>It’s useful to store useful functions separately</p>
<ul>
<li>Put <code>coefSummary</code> in file <code>routines.R</code>. Source it when starting R</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'../code/routines.R'</span>) <span class="co">#change path to directory where routines.R is stored</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Create your own R package (to be seen), document and share the code</li>
</ul>
<p>Note: <a href="https://www.tidymodels.org">tidymodels</a> and <a href="https://parsnip.tidymodels.org">parsnip</a> provide a unified interface for many statistical/machine learning models</p>
<p>Note: R package <code>caret</code> does as well (see an <a href="https://topepo.github.io/caret">introduction</a>)</p>
</section>
<section id="plotting-intervals" class="slide level2">
<h2>Plotting intervals</h2>
<p><code>coefplot</code> helps visualize 95% confidence intervals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefplot</span>(lmfit2, <span class="at">predictors=</span><span class="st">"cut"</span>) <span class="co">#show only parameters with name including "cut"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-25-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="residual-analysis" class="title-slide slide level1 center">
<h1>Residual analysis</h1>

</section>
<section id="linear-model-assumptions" class="slide level2">
<h2>Linear model assumptions</h2>
<ul>
<li><p>Linearity</p></li>
<li><p>Constant error variance</p></li>
<li><p>Error normality (if <span class="math inline">\(n\)</span> large, only important for prediction)</p></li>
<li><p>Uncorrelated errors</p></li>
</ul>
<p>Residuals vs predicted values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(<span class="at">x=</span>pred2, <span class="at">y=</span>res2)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-26-1.png" width="960" class="r-stretch"></section>
<section id="assessing-linearity" class="slide level2">
<h2>Assessing linearity</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(pred2, res2)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb36-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">0</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">'gray'</span>) <span class="sc">+</span></span>
<span id="cb36-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">'Model prediction'</span>, <span class="at">y=</span><span class="st">'Residuals'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-27-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Here non-linearity seems mostly due to (log) carats</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(lcarat, lprice)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>, <span class="at">col=</span><span class="st">'blue'</span>) <span class="sc">+</span></span>
<span id="cb37-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">col=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-28-1.png" width="960" class="r-stretch"></section>
<section id="assessing-constant-variance" class="slide level2">
<h2>Assessing constant variance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(<span class="at">x=</span>pred2, <span class="at">y=</span>res2)) <span class="sc">+</span> </span>
<span id="cb38-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">cut_width</span>(pred2, <span class="fl">0.2</span>))) <span class="sc">+</span></span>
<span id="cb38-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">'Model prediction'</span>, <span class="at">y=</span><span class="st">'Residuals'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-29-1.png" width="960" class="r-stretch"></section>
<section id="residual-normality" class="slide level2">
<h2>Residual normality</h2>
<p>Note: qq-normal plots require that residuals have 0 mean, variance=1 (function <code>scale</code>)</p>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Histogram (qqplot)</a></li><li><a href="#tabset-5-2">Histogram (base R)</a></li><li><a href="#tabset-5-3">qq-plot</a></li><li><a href="#tabset-5-4">qq-plot (base R)</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb39-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(<span class="at">x=</span>res)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span> ..density..)) <span class="sc">+</span></span>
<span id="cb39-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_overlay_normal_density</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb39-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">'Residuals'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-30-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">scale</span>(diamonds2<span class="sc">$</span>res), <span class="at">xlab=</span><span class="st">'Residuals'</span>, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">''</span>)</span>
<span id="cb40-2"><a href="" aria-hidden="true" tabindex="-1"></a>xseq<span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="at">length=</span><span class="dv">200</span>)</span>
<span id="cb40-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xseq, <span class="fu">dnorm</span>(xseq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-31-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(<span class="at">sample=</span><span class="fu">scale</span>(res))) <span class="sc">+</span></span>
<span id="cb41-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-32-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-4">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">scale</span>(diamonds2<span class="sc">$</span>res))</span>
<span id="cb42-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-33-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="exercise" class="title-slide slide level1 center">
<h1>Exercise</h1>

</section>
<section class="slide level2">

<p>FiveThirtyEight’s <a href="https://fivethirtyeight.com/features/higher-rates-of-hate-crimes-are-tied-to-income-inequality">post</a> on hate crimes around the 2016 USA elections</p>
<p>Dataset <code>hate_crimes</code> (package <code>fivethirtyeight</code>) has this info for each state:</p>
<ul>
<li><p><code>avg_hatecrimes_per_100k_fbi</code>: pre-election number of hate crimes per 100,000 population by the FBI</p></li>
<li><p>education (% adults <span class="math inline">\(\geq\)</span> 25 with high school degree)</p></li>
<li><p>% of people who voted Donald Trump</p></li>
<li><p>Income inequality (Gini index)</p></li>
</ul>
<p>Plus variables about racial diversity, economics etc (see <code>help(hate_crimes)</code>)</p>
</section>
<section class="slide level2 scrollable">

<p>Load the data, create a smaller version with the needed variables, and remove Hawaii (outcome not reported)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb43-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fivethirtyeight)</span>
<span id="cb43-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../code/routines.R"</span>)</span>
<span id="cb43-4"><a href="" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'state_abbrev'</span>,<span class="st">'avg_hatecrimes_per_100k_fbi'</span>,<span class="st">'share_vote_trump'</span>,<span class="st">'gini_index'</span>,<span class="st">'share_pop_hs'</span>)</span>
<span id="cb43-5"><a href="" aria-hidden="true" tabindex="-1"></a>hc<span class="ot">=</span> hate_crimes[,sel]</span>
<span id="cb43-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'state'</span>,<span class="st">'hatecrimes_fbi'</span>,<span class="st">'votes_trump'</span>,<span class="st">'gini'</span>,<span class="st">'hs'</span>)</span>
<span id="cb43-7"><a href="" aria-hidden="true" tabindex="-1"></a>hc<span class="ot">=</span> <span class="fu">filter</span>(hc, <span class="sc">!</span><span class="fu">is.na</span>(hatecrimes_fbi)) <span class="co">#outcome must be non-missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>Fit a linear regression for <code>hatecrimes_fbi</code> vs.&nbsp;<code>votes_trump</code>, <code>gini</code>, <code>hs</code>. Report the point estimate, 95% intervals and P-values for the 3 covariates. Which of them are significantly associated to hate crimes?</p></li>
<li><p>Assess the model assumptions: linearity, constant error variance, error normality. To what extent are they violated?</p></li>
</ol>
<p>Turn in an html with your solution at Aula Global Name your file firstname_lastname.html</p>
</section>
<section class="slide level2">

<p>Challenge: all variables are strongly correlated</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="" aria-hidden="true" tabindex="-1"></a>R<span class="ot">=</span> <span class="fu">select</span>(hc, <span class="sc">-</span>state) <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use=</span><span class="st">'pairwise.complete.obs'</span>)</span>
<span id="cb44-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot.mixed</span>(R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-35-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="interpreting-the-coefficients" class="title-slide slide level1 center">
<h1>Interpreting the coefficients</h1>

</section>
<section id="factors" class="slide level2">
<h2>Factors</h2>
<p>To interpret the coefficients of categorical variables, we must understand how they’re coded</p>
<p>To avoid problems, let’s store them as standard unordered factors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(diamonds2<span class="sc">$</span>cut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Ideal     Premium   Good      Very Good Fair     
Levels: Fair &lt; Good &lt; Very Good &lt; Premium &lt; Ideal</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(diamonds2<span class="sc">$</span>color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] E I J H F G D
Levels: D &lt; E &lt; F &lt; G &lt; H &lt; I &lt; J</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(diamonds2<span class="sc">$</span>clarity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] SI2  SI1  VS1  VS2  VVS2 VVS1 I1   IF  
Levels: I1 &lt; SI2 &lt; SI1 &lt; VS2 &lt; VS1 &lt; VVS2 &lt; VVS1 &lt; IF</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="" aria-hidden="true" tabindex="-1"></a>diamonds2<span class="ot">=</span> <span class="fu">mutate</span>(diamonds2, </span>
<span id="cb51-2"><a href="" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cut=</span><span class="fu">factor</span>(cut, <span class="at">ordered=</span><span class="cn">FALSE</span>), </span>
<span id="cb51-3"><a href="" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color=</span><span class="fu">factor</span>(color, <span class="at">ordered=</span><span class="cn">FALSE</span>), </span>
<span id="cb51-4"><a href="" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clarity=</span><span class="fu">factor</span>(clarity, <span class="at">ordered=</span><span class="cn">FALSE</span>) )</span>
<span id="cb51-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(diamonds2<span class="sc">$</span>cut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Ideal     Premium   Good      Very Good Fair     
Levels: Fair Good Very Good Premium Ideal</code></pre>
</div>
</div>
</section>
<section id="model.matrix" class="slide level2">
<h2>model.matrix</h2>
<p>Check how R codes internally the variables. Let’s focus on <code>cut</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> lcarat <span class="sc">+</span> cut, <span class="at">data=</span>diamonds2)</span>
<span id="cb53-2"><a href="" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)    lcarat cutGood cutVery Good cutPremium cutIdeal
1           1 -2.120294       0            0          0        1
2           1 -2.251539       0            0          1        0
3           1 -2.120294       1            0          0        0
4           1 -1.785875       0            0          1        0
5           1 -1.689660       1            0          0        0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">levels</span>(diamonds2<span class="sc">$</span>cut))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fair"      "Good"      "Very Good" "Premium"   "Ideal"    </code></pre>
</div>
</div>
<p>For <code>cut</code>, “Fair” is the reference category.</p>
</section>
<section class="slide level2">

<p>More precisely, the model is</p>
<p><span class="math display">\[
\mbox{lprice}_i= \beta_0 + \beta_1 \mbox{carat}_i + \beta_2 \mbox{good}_i + \beta_3 \mbox{very good}_i + \beta_4 \mbox{premium}_i + \beta_5 \mbox{ideal}_i + \epsilon_i
\]</span> When <code>cut</code> is fair and good we get (respectively)</p>
<p><span class="math display">\[E(\mbox{lprice}_i \mid \mbox{fair}_i=1, \mbox{carat}_i)= \beta_0 + \beta_1 \mbox{lcarat}_i\]</span></p>
<p><span class="math display">\[
E(\mbox{lprice}_i \mid \mbox{good}_i=1, \mbox{carat}_i)= \beta_0 + \beta_1 \mbox{lcarat}_i + \beta_2
\]</span></p>
<p>The predicted difference cut - fair diamond is hence <span class="math inline">\(\beta_2\)</span>, regardless of carats. To facilitate interpretation, since <span class="math inline">\(\mbox{lprice}_i\)</span> is <span class="math inline">\(\log_2\)</span> price,</p>
<p><span class="math display">\[
\frac{2^{E(\log_2 \mbox{price}_i \mid \mbox{good}_i=1)}}{2^{E(\log_2 \mbox{price}_i \mid \mbox{fair}_i=1)}}= 2^{\beta_2}
\]</span></p>
</section>
<section id="section" class="slide level2">
<h2></h2>
<p>Estimates and CIs in the log2-scale (recall: <code>coefSummary</code> is a function that we defined)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmfit2<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity, <span class="at">data=</span>diamonds2)</span>
<span id="cb57-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(lmfit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 4
   Parameter    Estimate `Conf. Int.`    `P-value`
   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    
 1 (Intercept)    11.3   (11.319,11.351) &lt;0.00001 
 2 lcarat          1.88  (1.882,1.886)   &lt;0.00001 
 3 cutGood         0.115 (0.104,0.126)   &lt;0.00001 
 4 cutVery Good    0.169 (0.159,0.179)   &lt;0.00001 
 5 cutPremium      0.201 (0.191,0.211)   &lt;0.00001 
 6 cutIdeal        0.233 (0.223,0.243)   &lt;0.00001 
 7 colorE         -0.078 (-0.084,-0.072) &lt;0.00001 
 8 colorF         -0.136 (-0.143,-0.13)  &lt;0.00001 
 9 colorG         -0.231 (-0.237,-0.225) &lt;0.00001 
10 colorH         -0.362 (-0.369,-0.356) &lt;0.00001 
11 colorI         -0.538 (-0.545,-0.53)  &lt;0.00001 
12 colorJ         -0.737 (-0.746,-0.729) &lt;0.00001 
13 claritySI2      0.617 (0.603,0.632)   &lt;0.00001 
14 claritySI1      0.855 (0.841,0.87)    &lt;0.00001 
15 clarityVS2      1.07  (1.056,1.085)   &lt;0.00001 
16 clarityVS1      1.17  (1.157,1.187)   &lt;0.00001 
17 clarityVVS2     1.37  (1.351,1.382)   &lt;0.00001 
18 clarityVVS1     1.47  (1.454,1.485)   &lt;0.00001 
19 clarityIF       1.61  (1.59,1.624)    &lt;0.00001 </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Let’s express them in the original scale. Fair -&gt; Good increases price by 1.08 (i.e.&nbsp;by 8%), Fair -&gt; Very good by 1.12 (i.e.&nbsp;by 12%), etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="" aria-hidden="true" tabindex="-1"></a>power2<span class="ot">=</span> <span class="cf">function</span>(x) <span class="dv">2</span><span class="sc">^</span>x</span>
<span id="cb59-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(lmfit2, <span class="at">transform=</span> power2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 4
   Parameter    Estimate `Conf. Int.`        `P-value`
   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;    
 1 (Intercept)  2583.    (2554.392,2612.707) &lt;0.00001 
 2 lcarat          3.69  (3.685,3.696)       &lt;0.00001 
 3 cutGood         1.08  (1.075,1.092)       &lt;0.00001 
 4 cutVery Good    1.12  (1.116,1.132)       &lt;0.00001 
 5 cutPremium      1.15  (1.141,1.158)       &lt;0.00001 
 6 cutIdeal        1.18  (1.167,1.183)       &lt;0.00001 
 7 colorE          0.947 (0.943,0.951)       &lt;0.00001 
 8 colorF          0.91  (0.906,0.914)       &lt;0.00001 
 9 colorG          0.852 (0.848,0.855)       &lt;0.00001 
10 colorH          0.778 (0.775,0.781)       &lt;0.00001 
11 colorI          0.689 (0.686,0.692)       &lt;0.00001 
12 colorJ          0.6   (0.596,0.604)       &lt;0.00001 
13 claritySI2      1.53  (1.519,1.55)        &lt;0.00001 
14 claritySI1      1.81  (1.791,1.828)       &lt;0.00001 
15 clarityVS2      2.1   (2.079,2.122)       &lt;0.00001 
16 clarityVS1      2.25  (2.23,2.276)        &lt;0.00001 
17 clarityVVS2     2.58  (2.551,2.606)       &lt;0.00001 
18 clarityVVS1     2.77  (2.74,2.8)          &lt;0.00001 
19 clarityIF       3.05  (3.01,3.082)        &lt;0.00001 </code></pre>
</div>
</div>
</section>
<section id="changing-the-reference-category" class="slide level2">
<h2>Changing the reference category</h2>
<p>Set J (worst color) as the reference category for <code>color</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="" aria-hidden="true" tabindex="-1"></a>diamonds2<span class="ot">=</span> <span class="fu">mutate</span>(diamonds2, <span class="at">color=</span><span class="fu">factor</span>(color, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">'J'</span>,<span class="st">'D'</span>,<span class="st">'E'</span>,<span class="st">'F'</span>,<span class="st">'G'</span>,<span class="st">'H'</span>,<span class="st">'I'</span>)))</span>
<span id="cb61-2"><a href="" aria-hidden="true" tabindex="-1"></a>lmfit3<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity, <span class="at">data=</span>diamonds2)</span>
<span id="cb61-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(lmfit3, <span class="at">transform=</span>power2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 4
   Parameter    Estimate `Conf. Int.`       `P-value`
   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;    
 1 (Intercept)   1550.   (1531.55,1568.241) &lt;0.00001 
 2 lcarat           3.69 (3.685,3.696)      &lt;0.00001 
 3 cutGood          1.08 (1.075,1.092)      &lt;0.00001 
 4 cutVery Good     1.12 (1.116,1.132)      &lt;0.00001 
 5 cutPremium       1.15 (1.141,1.158)      &lt;0.00001 
 6 cutIdeal         1.18 (1.167,1.183)      &lt;0.00001 
 7 colorD           1.67 (1.657,1.677)      &lt;0.00001 
 8 colorE           1.58 (1.57,1.588)       &lt;0.00001 
 9 colorF           1.52 (1.508,1.525)      &lt;0.00001 
10 colorG           1.42 (1.412,1.428)      &lt;0.00001 
11 colorH           1.30 (1.289,1.304)      &lt;0.00001 
12 colorI           1.15 (1.141,1.155)      &lt;0.00001 
13 claritySI2       1.53 (1.519,1.55)       &lt;0.00001 
14 claritySI1       1.81 (1.791,1.828)      &lt;0.00001 
15 clarityVS2       2.1  (2.079,2.122)      &lt;0.00001 
16 clarityVS1       2.25 (2.23,2.276)       &lt;0.00001 
17 clarityVVS2      2.58 (2.551,2.606)      &lt;0.00001 
18 clarityVVS1      2.77 (2.74,2.8)         &lt;0.00001 
19 clarityIF        3.05 (3.01,3.082)       &lt;0.00001 </code></pre>
</div>
</div>
</section>
<section id="displaying-the-predictions" class="slide level2">
<h2>Displaying the predictions</h2>
<p>Functions <code>data_grid</code> and <code>add_predictions</code> in package <code>modelr</code></p>
<ul>
<li><p>Define grid of predictor values</p></li>
<li><p>Store prediction for each</p></li>
<li><p>Unspecified predictors set to mean (continuous) or reference category (discrete)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="" aria-hidden="true" tabindex="-1"></a>mygrid<span class="ot">=</span> <span class="fu">data_grid</span>(diamonds2, cut, color, clarity, <span class="at">.model=</span>lmfit2)</span>
<span id="cb63-2"><a href="" aria-hidden="true" tabindex="-1"></a>mygrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 280 × 4
   cut   color clarity lcarat
   &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;
 1 Fair  J     I1      -0.515
 2 Fair  J     SI2     -0.515
 3 Fair  J     SI1     -0.515
 4 Fair  J     VS2     -0.515
 5 Fair  J     VS1     -0.515
 6 Fair  J     VVS2    -0.515
 7 Fair  J     VVS1    -0.515
 8 Fair  J     IF      -0.515
 9 Fair  D     I1      -0.515
10 Fair  D     SI2     -0.515
# ℹ 270 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmpred2<span class="ot">=</span> <span class="fu">add_predictions</span>(mygrid, <span class="at">model=</span>lmfit2)</span>
<span id="cb65-2"><a href="" aria-hidden="true" tabindex="-1"></a>lmpred2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 280 × 5
   cut   color clarity lcarat  pred
   &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt;
 1 Fair  J     I1      -0.515  9.63
 2 Fair  J     SI2     -0.515 10.2 
 3 Fair  J     SI1     -0.515 10.5 
 4 Fair  J     VS2     -0.515 10.7 
 5 Fair  J     VS1     -0.515 10.8 
 6 Fair  J     VVS2    -0.515 11.0 
 7 Fair  J     VVS1    -0.515 11.1 
 8 Fair  J     IF      -0.515 11.2 
 9 Fair  D     I1      -0.515 10.4 
10 Fair  D     SI2     -0.515 11.0 
# ℹ 270 more rows</code></pre>
</div>
</div>
<p><code>add_predictions</code> requires that <code>model</code> is of type <code>lm</code> / object that has a <code>predict</code> method</p>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lmpred2, <span class="fu">aes</span>(<span class="at">x=</span>clarity, <span class="at">y=</span>pred, <span class="at">color=</span>color)) <span class="sc">+</span></span>
<span id="cb67-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb67-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> cut) <span class="sc">+</span></span>
<span id="cb67-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">'log2 (price)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-45-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="linear-contrasts" class="title-slide slide level1 center">
<h1>Linear contrasts</h1>

</section>
<section id="linear-contrasts-1" class="slide level2">
<h2>Linear contrasts</h2>
<p>We wish to obtain a conf. int. for cut= “Ideal” - “Premium”</p>
<ul>
<li><p><span class="math inline">\(\beta_5\)</span>: mean for “Premium” - mean for “Fair” (reference)</p></li>
<li><p><span class="math inline">\(\beta_6\)</span>: mean for “Ideal” - mean for “Fair” (reference)</p></li>
<li><p><span class="math inline">\(\beta_6 - \beta_5\)</span>: mean for “Ideal” - mean for “Premium”</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(lmfit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 4
   Parameter    Estimate `Conf. Int.`    `P-value`
   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    
 1 (Intercept)    11.3   (11.319,11.351) &lt;0.00001 
 2 lcarat          1.88  (1.882,1.886)   &lt;0.00001 
 3 cutGood         0.115 (0.104,0.126)   &lt;0.00001 
 4 cutVery Good    0.169 (0.159,0.179)   &lt;0.00001 
 5 cutPremium      0.201 (0.191,0.211)   &lt;0.00001 
 6 cutIdeal        0.233 (0.223,0.243)   &lt;0.00001 
 7 colorE         -0.078 (-0.084,-0.072) &lt;0.00001 
 8 colorF         -0.136 (-0.143,-0.13)  &lt;0.00001 
 9 colorG         -0.231 (-0.237,-0.225) &lt;0.00001 
10 colorH         -0.362 (-0.369,-0.356) &lt;0.00001 
11 colorI         -0.538 (-0.545,-0.53)  &lt;0.00001 
12 colorJ         -0.737 (-0.746,-0.729) &lt;0.00001 
13 claritySI2      0.617 (0.603,0.632)   &lt;0.00001 
14 claritySI1      0.855 (0.841,0.87)    &lt;0.00001 
15 clarityVS2      1.07  (1.056,1.085)   &lt;0.00001 
16 clarityVS1      1.17  (1.157,1.187)   &lt;0.00001 
17 clarityVVS2     1.37  (1.351,1.382)   &lt;0.00001 
18 clarityVVS1     1.47  (1.454,1.485)   &lt;0.00001 
19 clarityIF       1.61  (1.59,1.624)    &lt;0.00001 </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p><strong>Goal.</strong> Test <span class="math inline">\(H_0: \beta_6 - \beta_5=0\)</span>. Get 95% confidence interval</p>
<p>Linear contrasts done by <code>glht</code> (general linear hypotheses, R package <code>multcomp</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="" aria-hidden="true" tabindex="-1"></a>C<span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="fu">length</span>(<span class="fu">coef</span>(lmfit2)))</span>
<span id="cb70-2"><a href="" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">1</span>,<span class="dv">5</span>]<span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span>; C[<span class="dv">1</span>,<span class="dv">6</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb70-3"><a href="" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="co">#show first 10 columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0  0  0  0 -1  1  0  0  0  0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="" aria-hidden="true" tabindex="-1"></a>PvsI<span class="ot">=</span> <span class="fu">glht</span>(lmfit2, C)</span>
<span id="cb72-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PvsI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Simultaneous Tests for General Linear Hypotheses

Fit: lm(formula = lprice ~ lcarat + cut + color + clarity, data = diamonds2)

Linear Hypotheses:
       Estimate Std. Error t value Pr(&gt;|t|)    
1 == 0  0.03156    0.00215   14.68   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
(Adjusted p values reported -- single-step method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(PvsI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Simultaneous Confidence Intervals

Fit: lm(formula = lprice ~ lcarat + cut + color + clarity, data = diamonds2)

Quantile = 1.96
95% family-wise confidence level
 

Linear Hypotheses:
       Estimate lwr     upr    
1 == 0 0.03156  0.02734 0.03577</code></pre>
</div>
</div>
</section>
<section id="doing-it-on-our-own" class="slide level2">
<h2>Doing it on our own</h2>
<p>Recall that <span class="math inline">\(\hat{\beta} \sim N(\beta, V)\)</span>, where <span class="math inline">\(V= \sigma^2 (X^T X)^{-1}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="" aria-hidden="true" tabindex="-1"></a>bhat<span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">coef</span>(lmfit2), <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb76-2"><a href="" aria-hidden="true" tabindex="-1"></a>V<span class="ot">=</span> <span class="fu">vcov</span>(lmfit2)</span>
<span id="cb76-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">diag</span>(V)), <span class="dv">5</span>) <span class="co">#SE's for beta's (compare to summary(lmfit2))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)       lcarat      cutGood cutVery Good   cutPremium     cutIdeal 
     0.00831      0.00113      0.00561      0.00522      0.00516      0.00512 
      colorE       colorF       colorG       colorH       colorI       colorJ 
     0.00306      0.00309      0.00302      0.00321      0.00360      0.00443 
  claritySI2   claritySI1   clarityVS2   clarityVS1  clarityVVS2  clarityVVS1 
     0.00747      0.00743      0.00747      0.00758      0.00782      0.00804 
   clarityIF 
     0.00870 </code></pre>
</div>
</div>
<p>Recall that <span class="math inline">\(C \hat{\beta} \sim N(C \beta, C V C^T)\)</span>. For us <span class="math inline">\(C \hat{\beta}= \hat{\beta}_6 - \hat{\beta}_5\)</span>, <span class="math inline">\(C\beta =\beta_6 - \beta_5\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="" aria-hidden="true" tabindex="-1"></a>dhat<span class="ot">=</span> C <span class="sc">%*%</span> bhat</span>
<span id="cb78-2"><a href="" aria-hidden="true" tabindex="-1"></a>se<span class="ot">=</span> <span class="fu">sqrt</span>(C <span class="sc">%*%</span> V <span class="sc">%*%</span> <span class="fu">t</span>(C))</span>
<span id="cb78-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(se, <span class="dv">5</span>) <span class="co">#matches previous slide</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]
[1,] 0.00215</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="" aria-hidden="true" tabindex="-1"></a>dhat.ci<span class="ot">=</span> <span class="fu">c</span>(<span class="at">estimate=</span>dhat, <span class="at">ci.low=</span> dhat <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se, <span class="at">ci.up=</span> dhat <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb80-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(dhat.ci, <span class="dv">5</span>) <span class="co">#matches previous slide</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>estimate   ci.low    ci.up 
 0.03156  0.02734  0.03577 </code></pre>
</div>
</div>
</section></section>
<section>
<section id="interactions" class="title-slide slide level1 center">
<h1>Interactions</h1>

</section>
<section class="slide level2">

<p>The effect of a covariate may depend on others</p>
<p><strong>Example.</strong> Does effect of carats depend on cut?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(lcarat, lprice, <span class="at">color=</span>cut)) <span class="sc">+</span></span>
<span id="cb82-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-51-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Let’s fit a model with interactions. All coefficients are statistically significant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmfit3<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> lcarat<span class="sc">:</span>cut, <span class="at">data=</span>diamonds2)</span>
<span id="cb83-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(lmfit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   Parameter           Estimate `Conf. Int.`   `P-value`
   &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    
 1 (Intercept)           11.8   (11.794,11.83) &lt;0.00001 
 2 lcarat                 1.50  (1.468,1.521)  &lt;0.00001 
 3 cutGood                0.272 (0.25,0.293)   &lt;0.00001 
 4 cutVery Good           0.382 (0.363,0.402)  &lt;0.00001 
 5 cutPremium             0.346 (0.327,0.365)  &lt;0.00001 
 6 cutIdeal               0.484 (0.465,0.504)  &lt;0.00001 
 7 lcarat:cutGood         0.241 (0.211,0.271)  &lt;0.00001 
 8 lcarat:cutVery Good    0.232 (0.204,0.259)  &lt;0.00001 
 9 lcarat:cutPremium      0.162 (0.135,0.19)   &lt;0.00001 
10 lcarat:cutIdeal        0.212 (0.185,0.24)   &lt;0.00001 </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>We just fitted the model</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mbox{lprice}_i= \beta_0 + \beta_1 \mbox{lcarat}_i + \beta_2 \mbox{good}_i + \beta_3 \mbox{vgood}_i + \beta_4 \mbox{premium}_i + \beta_5 \mbox{ideal}_i +
\\
&amp;
\beta_6 \mbox{lcarat}_i \mbox{good}_i + \beta_7 \mbox{lcarat}_i \mbox{vgood}_i + \beta_8 \mbox{lcarat}_i \mbox{premium}_i + \beta_9 \mbox{lcarat}_i \mbox{ideal}_i + \epsilon_i
\end{aligned}
\]</span></p>
<p>For example, when cut=“fair” <span class="math display">\[
\mbox{lprice}_i= \beta_0 + \beta_1 \mbox{lcarat}_i
\]</span> and when cut=“good” <span class="math display">\[
\mbox{lprice}_i= \beta_0 + \beta_2 + (\beta_1 + \beta_6) \mbox{lcarat}_i
\]</span></p>
<p>How do we interpret <span class="math inline">\(\beta_6\)</span>?</p>
</section>
<section class="slide level2 scrollable">

<p>If <span class="math inline">\(H_0: \beta_6=\beta_7=\beta_8=\beta_9=0\)</span>, then no interactions needed</p>
<ol type="1">
<li><p>Fit models with and without interactions</p></li>
<li><p>Compare with likelihood-ratio test (=ANOVA for linear models)</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmfit4<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut, <span class="at">data=</span>diamonds2)</span>
<span id="cb85-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmfit4, lmfit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: lprice ~ lcarat + cut
Model 2: lprice ~ lcarat + cut + lcarat:cut
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1  53934 7270.0                                  
2  53930 7210.1  4    59.874 111.96 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="the-full-exercise" class="slide level2">
<h2>The full exercise</h2>
<p>Consider all possible interactions. All P-values are highly statistically significant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmfull<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity <span class="sc">+</span> lcarat<span class="sc">:</span>cut <span class="sc">+</span> lcarat<span class="sc">:</span>color <span class="sc">+</span> lcarat<span class="sc">:</span>clarity, <span class="at">data=</span>diamonds2)</span>
<span id="cb87-2"><a href="" aria-hidden="true" tabindex="-1"></a>lmdrop1<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity <span class="sc">+</span> lcarat<span class="sc">:</span>color <span class="sc">+</span> lcarat<span class="sc">:</span>clarity, <span class="at">data=</span>diamonds2)</span>
<span id="cb87-3"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue1<span class="ot">=</span> <span class="fu">anova</span>(lmdrop1, lmfull)[[<span class="st">'Pr(&gt;F)'</span>]][<span class="dv">2</span>]</span>
<span id="cb87-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="" aria-hidden="true" tabindex="-1"></a>lmdrop2<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity <span class="sc">+</span> lcarat<span class="sc">:</span>cut <span class="sc">+</span> lcarat<span class="sc">:</span>clarity, <span class="at">data=</span>diamonds2)</span>
<span id="cb87-6"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue2<span class="ot">=</span> <span class="fu">anova</span>(lmdrop2, lmfull)[[<span class="st">'Pr(&gt;F)'</span>]][<span class="dv">2</span>]</span>
<span id="cb87-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="" aria-hidden="true" tabindex="-1"></a>lmdrop3<span class="ot">=</span> <span class="fu">lm</span>(lprice <span class="sc">~</span> lcarat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity <span class="sc">+</span> lcarat<span class="sc">:</span>cut <span class="sc">+</span> lcarat<span class="sc">:</span>color, <span class="at">data=</span>diamonds2)</span>
<span id="cb87-9"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue3<span class="ot">=</span> <span class="fu">anova</span>(lmdrop3, lmfull)[[<span class="st">'Pr(&gt;F)'</span>]][<span class="dv">2</span>]</span>
<span id="cb87-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(pvalue1, pvalue2, pvalue3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.092037e-272  9.480426e-27 1.017366e-132</code></pre>
</div>
</div>
<p>However, predictions are nearly identical</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmfit2)<span class="sc">$</span>r.squared <span class="co">#additive model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9826161</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmfull)<span class="sc">$</span>r.squared <span class="co">#additive + all pairwise interactions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9832858</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="" aria-hidden="true" tabindex="-1"></a>diamonds2<span class="sc">$</span>predfull<span class="ot">=</span> <span class="fu">predict</span>(lmfull)</span>
<span id="cb93-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(diamonds2<span class="sc">$</span>pred2, diamonds2<span class="sc">$</span>predfull)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9996594</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li><p>Earlier we plotted price vs.&nbsp;carat &amp; cut. <code>carat:cut</code> impacted predictions</p></li>
<li><p>Regressing price vs.&nbsp;carat, cut, color &amp; clarity. &lt;interactions don’t change predictions much</p></li>
</ul>
<p>Why? After adding all covariates, estimated interaction coef. became smaller</p>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">Carat &amp; Cut</a></li><li><a href="#tabset-6-2">All covariates</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: left;">Conf. Int.</th>
<th style="text-align: left;">P-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lcarat:cutGood</td>
<td style="text-align: right;">0.241</td>
<td style="text-align: left;">(0.211,0.271)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:cutVery Good</td>
<td style="text-align: right;">0.232</td>
<td style="text-align: left;">(0.204,0.259)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:cutPremium</td>
<td style="text-align: right;">0.162</td>
<td style="text-align: left;">(0.135,0.19)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:cutIdeal</td>
<td style="text-align: right;">0.212</td>
<td style="text-align: left;">(0.185,0.24)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-6-2">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: left;">Conf. Int.</th>
<th style="text-align: left;">P-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lcarat:cutGood</td>
<td style="text-align: right;">0.080</td>
<td style="text-align: left;">(0.064,0.095)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:cutVery Good</td>
<td style="text-align: right;">0.096</td>
<td style="text-align: left;">(0.081,0.111)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:cutPremium</td>
<td style="text-align: right;">0.011</td>
<td style="text-align: left;">(-0.004,0.026)</td>
<td style="text-align: left;">0.14689</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:cutIdeal</td>
<td style="text-align: right;">0.083</td>
<td style="text-align: left;">(0.069,0.098)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:colorD</td>
<td style="text-align: right;">-0.004</td>
<td style="text-align: left;">(-0.015,0.006)</td>
<td style="text-align: left;">0.42455</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:colorE</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: left;">(-0.004,0.015)</td>
<td style="text-align: left;">0.27212</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:colorF</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: left;">(0.018,0.037)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:colorG</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: left;">(0.018,0.037)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:colorH</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: left;">(-0.005,0.014)</td>
<td style="text-align: left;">0.33373</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:colorI</td>
<td style="text-align: right;">0.018</td>
<td style="text-align: left;">(0.008,0.028)</td>
<td style="text-align: left;">0.00037</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:claritySI2</td>
<td style="text-align: right;">0.239</td>
<td style="text-align: left;">(0.218,0.261)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:claritySI1</td>
<td style="text-align: right;">0.254</td>
<td style="text-align: left;">(0.233,0.276)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:clarityVS2</td>
<td style="text-align: right;">0.226</td>
<td style="text-align: left;">(0.204,0.247)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:clarityVS1</td>
<td style="text-align: right;">0.238</td>
<td style="text-align: left;">(0.216,0.26)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:clarityVVS2</td>
<td style="text-align: right;">0.229</td>
<td style="text-align: left;">(0.207,0.252)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="even">
<td style="text-align: left;">lcarat:clarityVVS1</td>
<td style="text-align: right;">0.205</td>
<td style="text-align: left;">(0.182,0.228)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lcarat:clarityIF</td>
<td style="text-align: right;">0.218</td>
<td style="text-align: left;">(0.194,0.243)</td>
<td style="text-align: left;">&lt;0.00001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p><code>multiplot</code> visually compares coefficients across models. Interactions lcarat:cut are smaller under the full model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(lmfull, lmfit3, <span class="at">intercept=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-59-1.png" width="960" class="r-stretch"></section>
<section id="specifying-interactions-in-r" class="slide level2">
<h2>Specifying interactions in R</h2>
<p>We simulate some data for illustration</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>); x2<span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>); x3<span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb96-2"><a href="" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, x1 <span class="sc">+</span> x2<span class="sc">/</span><span class="dv">2</span>, <span class="at">sd=</span><span class="dv">1</span>)  <span class="co">#y = x1 + x2/2 + e, e ~ N(0,1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Three ways to specify the same regression equation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x1<span class="sc">:</span>x2 <span class="sc">+</span> x1<span class="sc">:</span>x3 <span class="sc">+</span> x2<span class="sc">:</span>x3)</span>
<span id="cb97-2"><a href="" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1<span class="sc">*</span>x2 <span class="sc">+</span> x1<span class="sc">*</span>x3 <span class="sc">+</span> x2<span class="sc">*</span>x3) <span class="co">#with * you can drop the additive terms</span></span>
<span id="cb97-3"><a href="" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> (x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3)<span class="sc">^</span><span class="dv">2</span>) <span class="co">#^2 adds main effects + interactions in one go</span></span>
<span id="cb97-4"><a href="" aria-hidden="true" tabindex="-1"></a>fit3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ (x1 + x2 + x3)^2)

Coefficients:
(Intercept)           x1           x2           x3        x1:x2        x1:x3  
    0.13701      1.22747      0.52670      0.03152     -0.04235      0.06459  
      x2:x3  
   -0.01678  </code></pre>
</div>
</div>
</section></section>
<section>
<section id="nested-models" class="title-slide slide level1 center">
<h1>Nested models</h1>

</section>
<section class="slide level2">

<p>A particular type of interaction is when data are nested within units (e.g.&nbsp;countries), and we wanna fit a model for each unit</p>
<p><strong>Example</strong> gapminder data (country life expectancy over time)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb99-2"><a href="" aria-hidden="true" tabindex="-1"></a>gapminder</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# ℹ 1,694 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(year, lifeExp, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb101-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> continent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-63-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Two ways to fit a model separately for each country:</p>
<ul>
<li><p><code>lm</code> plus interaction with country. Check which is the reference country, recover intercept/slopes for the rest</p></li>
<li><p>Use <code>group_by</code> and <code>map_df</code></p></li>
</ul>
<p>Note: better alternatives to fit nested models (random effects/hierarchical models)</p>
<p>First, group by country and <code>nest</code> dataset: each row is a country, and column <code>$data</code> is a list of tibbles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="" aria-hidden="true" tabindex="-1"></a>gm_country<span class="ot">=</span> <span class="fu">group_by</span>(gapminder, country, continent) <span class="sc">|&gt;</span> <span class="fu">nest</span>() </span>
<span id="cb102-2"><a href="" aria-hidden="true" tabindex="-1"></a>gm_country</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 142 × 3
# Groups:   country, continent [142]
   country     continent data             
   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           
 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;
 2 Albania     Europe    &lt;tibble [12 × 4]&gt;
 3 Algeria     Africa    &lt;tibble [12 × 4]&gt;
 4 Angola      Africa    &lt;tibble [12 × 4]&gt;
 5 Argentina   Americas  &lt;tibble [12 × 4]&gt;
 6 Australia   Oceania   &lt;tibble [12 × 4]&gt;
 7 Austria     Europe    &lt;tibble [12 × 4]&gt;
 8 Bahrain     Asia      &lt;tibble [12 × 4]&gt;
 9 Bangladesh  Asia      &lt;tibble [12 × 4]&gt;
10 Belgium     Europe    &lt;tibble [12 × 4]&gt;
# ℹ 132 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Second, define a function to be applied to each dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="" aria-hidden="true" tabindex="-1"></a>fitmodel<span class="ot">=</span> <span class="cf">function</span>(df) {</span>
<span id="cb104-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Return OLS and R2 for lifeExp ~ year</span></span>
<span id="cb104-3"><a href="" aria-hidden="true" tabindex="-1"></a>  fit<span class="ot">=</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> year, <span class="at">data=</span>df)</span>
<span id="cb104-4"><a href="" aria-hidden="true" tabindex="-1"></a>  ans<span class="ot">=</span> <span class="fu">c</span>(<span class="fu">coef</span>(fit), <span class="fu">summary</span>(fit)<span class="sc">$</span>r.squared)</span>
<span id="cb104-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ans)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'b0'</span>,<span class="st">'b1'</span>,<span class="st">'R2'</span>)</span>
<span id="cb104-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ans)</span>
<span id="cb104-7"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, use <code>map_df</code> to apply <code>fitmodel</code> to each entry of the list <code>gm_country$data</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="" aria-hidden="true" tabindex="-1"></a>coef_gm <span class="ot">=</span> <span class="fu">map_df</span>(gm_country<span class="sc">$</span>data, fitmodel)</span>
<span id="cb105-2"><a href="" aria-hidden="true" tabindex="-1"></a>coef_gm <span class="ot">=</span> <span class="fu">cbind</span>(gm_country, coef_gm)</span>
<span id="cb105-3"><a href="" aria-hidden="true" tabindex="-1"></a>coef_gm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 142 × 6
# Groups:   country, continent [142]
   country     continent data                  b0    b1    R2
   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;  -508. 0.275 0.948
 2 Albania     Europe    &lt;tibble [12 × 4]&gt;  -594. 0.335 0.911
 3 Algeria     Africa    &lt;tibble [12 × 4]&gt; -1068. 0.569 0.985
 4 Angola      Africa    &lt;tibble [12 × 4]&gt;  -377. 0.209 0.888
 5 Argentina   Americas  &lt;tibble [12 × 4]&gt;  -390. 0.232 0.996
 6 Australia   Oceania   &lt;tibble [12 × 4]&gt;  -376. 0.228 0.980
 7 Austria     Europe    &lt;tibble [12 × 4]&gt;  -406. 0.242 0.992
 8 Bahrain     Asia      &lt;tibble [12 × 4]&gt;  -860. 0.468 0.967
 9 Bangladesh  Asia      &lt;tibble [12 × 4]&gt;  -936. 0.498 0.989
10 Belgium     Europe    &lt;tibble [12 × 4]&gt;  -340. 0.209 0.995
# ℹ 132 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>The <span class="math inline">\(R^2\)</span> coefficient is large for most countries, but pretty small for a few</p>
<div class="panel-tabset">
<ul id="tabset-7" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-7-1"><span class="math inline">\(R^2\)</span> histogram</a></li><li><a href="#tabset-7-2">Countries</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coef_gm, <span class="fu">aes</span>(<span class="at">x=</span>R2)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-67-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-7-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#dplyr:filter and dplyr::select ensures using functions (filter,select) from package dplyr</span></span>
<span id="cb108-2"><a href="" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(coef_gm, R2 <span class="sc">&lt;</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(country, continent, R2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
# Groups:   country, continent [13]
   country                  continent     R2
   &lt;fct&gt;                    &lt;fct&gt;      &lt;dbl&gt;
 1 Botswana                 Africa    0.0340
 2 Central African Republic Africa    0.493 
 3 Congo, Dem. Rep.         Africa    0.348 
 4 Cote d'Ivoire            Africa    0.283 
 5 Kenya                    Africa    0.443 
 6 Lesotho                  Africa    0.0849
 7 Namibia                  Africa    0.437 
 8 Rwanda                   Africa    0.0172
 9 South Africa             Africa    0.312 
10 Swaziland                Africa    0.0682
11 Uganda                   Africa    0.342 
12 Zambia                   Africa    0.0598
13 Zimbabwe                 Africa    0.0562</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Unnest the dataset and add predictions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="" aria-hidden="true" tabindex="-1"></a>coef_gmu<span class="ot">=</span> <span class="fu">unnest</span>(coef_gm, <span class="at">cols=</span><span class="fu">names</span>(coef_gm))  <span class="co">#unnest &amp; keep all columns</span></span>
<span id="cb110-2"><a href="" aria-hidden="true" tabindex="-1"></a>coef_gmu<span class="sc">$</span>pred<span class="ot">=</span> coef_gmu<span class="sc">$</span>b0 <span class="sc">+</span> coef_gmu<span class="sc">$</span>b1 <span class="sc">*</span> coef_gmu<span class="sc">$</span>year</span>
<span id="cb110-3"><a href="" aria-hidden="true" tabindex="-1"></a>coef_gmu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 10
# Groups:   country, continent [142]
   country     continent  year lifeExp     pop gdpPercap    b0    b1    R2  pred
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8.43e6      779. -508. 0.275 0.948  29.9
 2 Afghanistan Asia       1957    30.3  9.24e6      821. -508. 0.275 0.948  31.3
 3 Afghanistan Asia       1962    32.0  1.03e7      853. -508. 0.275 0.948  32.7
 4 Afghanistan Asia       1967    34.0  1.15e7      836. -508. 0.275 0.948  34.0
 5 Afghanistan Asia       1972    36.1  1.31e7      740. -508. 0.275 0.948  35.4
 6 Afghanistan Asia       1977    38.4  1.49e7      786. -508. 0.275 0.948  36.8
 7 Afghanistan Asia       1982    39.9  1.29e7      978. -508. 0.275 0.948  38.2
 8 Afghanistan Asia       1987    40.8  1.39e7      852. -508. 0.275 0.948  39.5
 9 Afghanistan Asia       1992    41.7  1.63e7      649. -508. 0.275 0.948  40.9
10 Afghanistan Asia       1997    41.8  2.22e7      635. -508. 0.275 0.948  42.3
# ℹ 1,694 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="" aria-hidden="true" tabindex="-1"></a>poorfit<span class="ot">=</span> <span class="fu">filter</span>(coef_gmu, R2 <span class="sc">&lt;</span> <span class="fl">0.25</span>) <span class="co">#countries with low R2</span></span>
<span id="cb112-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(poorfit) <span class="sc">+</span></span>
<span id="cb112-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(year, lifeExp)) <span class="sc">+</span></span>
<span id="cb112-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(year, pred), <span class="at">col=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="05_basicmodels_files/figure-revealjs/unnamed-chunk-70-1.png" width="960" class="r-stretch"><p>Can you explain any of these patterns?</p>
</section></section>
<section>
<section id="summary-of-useful-functions" class="title-slide slide level1 center">
<h1>Summary of useful functions</h1>

</section>
<section id="useful-functions" class="slide level2">
<h2>Useful functions</h2>
<ul>
<li><p>Fitting the model: <code>lm</code>, <code>predict</code>, <code>residuals</code></p></li>
<li><p>Extract inference from fitted model: <code>summary</code>, <code>confint</code></p></li>
<li><p>Plot coefficients: <code>coefplot</code>, <code>multiplot</code></p></li>
<li><p>Plot predictions: <code>data_grid</code>, <code>add_predictions</code></p></li>
<li><p>Diagnostics: <code>geom_smooth</code>, <code>geom_boxplot</code>, <code>geom_qq</code></p></li>
</ul>
</section></section>
<section>
<section id="exercise-1" class="title-slide slide level1 center">
<h1>Exercise</h1>
<p>Select 3 countries, create factor <code>country</code> with 3 levels. Create <code>years_since_1952</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb113-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb113-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../code/routines.R"</span>)</span>
<span id="cb113-4"><a href="" aria-hidden="true" tabindex="-1"></a>gm3<span class="ot">=</span> gapminder <span class="sc">|&gt;</span> </span>
<span id="cb113-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'France'</span>,<span class="st">'Italy'</span>,<span class="st">'Spain'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb113-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">country=</span> <span class="fu">factor</span>(country), <span class="at">years_since_1952=</span> year <span class="sc">-</span> <span class="dv">1952</span>)</span>
<span id="cb113-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">=</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> years_since_1952 <span class="sc">+</span> country, <span class="at">data=</span>gm3)</span>
<span id="cb113-9"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  Parameter        Estimate `Conf. Int.`    `P-value`
  &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    
1 (Intercept)        67.1   (66.551,67.679) &lt;0.00001 
2 years_since_1952    0.263 (0.249,0.277)   &lt;0.00001 
3 countryItaly       -0.335 (-0.922,0.252)  0.25348  
4 countrySpain       -0.145 (-0.732,0.441)  0.61706  </code></pre>
</div>
</div>
<ul>
<li><p>For France: <span class="math inline">\(E(y_i)= \beta_0 + \beta_1 (\mbox{year}_i - 1952)\)</span></p></li>
<li><p>For Italy: <span class="math inline">\(E(y_i)= \beta_0 + \beta_2 + \beta_1 (\mbox{year}_i - 1952)\)</span></p></li>
</ul>
<p>How do we interpret <span class="math inline">\(\beta_0\)</span>? And <span class="math inline">\(\beta_0 + \beta_2\)</span>?</p>
</section>
<section class="slide level2">

<p><code>country</code> has 3 levels. <code>contrasts</code> shows how they’re coded</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gm3<span class="sc">$</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "France" "Italy"  "Spain" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(gm3<span class="sc">$</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Italy Spain
France     0     0
Italy      1     0
Spain      0     1</code></pre>
</div>
</div>
<p>Recall that <span class="math inline">\(x_{i1}\)</span> is the year. Internally R defines</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[
x_{i2}= \begin{cases} 1 \mbox{, if country}_i=\mbox{Italy} \\ 0 \mbox{, else} \end{cases}
\]</span></p>
</div><div class="column" style="width:50%;">
<p><span class="math display">\[
x_{i3}= \begin{cases} 1 \mbox{, if country}_i=\mbox{Spain} \\ 0 \mbox{, else} \end{cases}
\]</span></p>
</div></div>
<p>Alternative to 0/1 coding: <strong>sum-to-zero constraint</strong>. In our example</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[
x_{i2}= \begin{cases} 1 \mbox{, if country}_i=\mbox{France} \\ -1 \mbox{, if country}_i=\mbox{Spain} \\ 0 \mbox{, else} \end{cases}
\]</span></p>
</div><div class="column" style="width:50%;">
<p><span class="math display">\[
x_{i3}= \begin{cases} 1 \mbox{, if country}_i=\mbox{Italy} \\ -1 \mbox{, if country}_i=\mbox{Spain}  \\ 0 \mbox{, else} \end{cases}
\]</span></p>
</div></div>
</section>
<section class="slide level2">

<p>sum-to-zero coding can be done with <code>contrasts</code> and <code>contr.sum</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">contr.sum</span>(<span class="fu">levels</span>(gm3<span class="sc">$</span>country)) <span class="co">#check what the sum-to-zero codes look like</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1] [,2]
France    1    0
Italy     0    1
Spain    -1   -1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="" aria-hidden="true" tabindex="-1"></a>gm3<span class="sc">$</span>country0<span class="ot">=</span> gm3<span class="sc">$</span>country <span class="co">#create new variable</span></span>
<span id="cb121-2"><a href="" aria-hidden="true" tabindex="-1"></a>c0<span class="ot">=</span> <span class="fu">contr.sum</span>(<span class="fu">levels</span>(gm3<span class="sc">$</span>country0)) <span class="co">#tell contr.sum the factor levels</span></span>
<span id="cb121-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(c0)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'France'</span>,<span class="st">'Italy'</span>)   <span class="co">#set column names to facilitate interpreting coef.</span></span>
<span id="cb121-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(gm3<span class="sc">$</span>country0) <span class="ot">=</span> c0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s fit the model with the new coding</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> years_since_1952 <span class="sc">+</span> country0, <span class="at">data=</span>gm3)</span>
<span id="cb122-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  Parameter        Estimate `Conf. Int.`    `P-value`
  &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    
1 (Intercept)        67.0   (66.504,67.406) &lt;0.00001 
2 years_since_1952    0.263 (0.249,0.277)   &lt;0.00001 
3 country0France      0.16  (-0.179,0.499)  0.34281  
4 country0Italy      -0.175 (-0.514,0.164)  0.30103  </code></pre>
</div>
</div>
<p>Results for <span class="math inline">\(\beta_1\)</span> (years) as before. Different for <span class="math inline">\((\hat{\beta}_0, \hat{\beta}_2, \hat{\beta}_3)\)</span></p>
</section>
<section id="interpretation" class="slide level2">
<h2>Interpretation</h2>
<p><span class="math display">\[
E(y_i)= \beta_0 + \beta_1 (x_{i1} - 1952) + \beta_2 x_{i2} + \beta_3 x_{i3}
\]</span></p>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[
x_{i2}= \begin{cases} 1 \mbox{, if country}_i=\mbox{France} \\ -1 \mbox{, if country}_i=\mbox{Spain} \\ 0 \mbox{, else} \end{cases}
\]</span></p>
</div><div class="column" style="width:50%;">
<p><span class="math display">\[
x_{i3}= \begin{cases} 1 \mbox{, if country}_i=\mbox{Italy} \\ -1 \mbox{, if country}_i=\mbox{Spain}  \\ 0 \mbox{, else} \end{cases}
\]</span></p>
</div></div>
<ul>
<li><p>For France: <span class="math inline">\(E(y_i)= \beta_0 + \beta_2 + \beta_1 (x_{i1} - 1952)\)</span></p></li>
<li><p>For Italy: <span class="math inline">\(E(y_i)= \beta_0 + \beta_3 + \beta_1 (x_{i1} - 1952)\)</span></p></li>
<li><p>For Spain: <span class="math inline">\(E(y_i)= \beta_0 - \beta_2 - \beta_3 + \beta_1 (x_{i1} - 1952)\)</span></p></li>
<li><p>Average across countries: <span class="math inline">\(E(y_i)= \beta_0 + \beta_1 (x_{i1} - 1952)\)</span></p></li>
</ul>
<p><span class="math inline">\(\beta_0\)</span> is the mean life exp. at 1952 across countries</p>
<p><span class="math inline">\(\beta_2\)</span> is France’s deviation from that mean. <span class="math inline">\(\beta_3\)</span> is Italy’s. <span class="math inline">\(-\beta_2 - \beta_3\)</span> is Spain’s</p>
</section>
<section id="exercise-2" class="slide level2">
<h2>Exercise</h2>
<p>Fit a model with interactions with the 0/1 coding and with the sum-to-zero coding. Interpret the estimated parameter values from each model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">=</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> years_since_1952 <span class="sc">+</span> country <span class="sc">+</span> years_since_1952<span class="sc">:</span>country, <span class="at">data=</span>gm3)</span>
<span id="cb124-2"><a href="" aria-hidden="true" tabindex="-1"></a>fit4<span class="ot">=</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> years_since_1952 <span class="sc">+</span> country0 <span class="sc">+</span> years_since_1952<span class="sc">:</span>country0, <span class="at">data=</span>gm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="05_basicmodels_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="05_basicmodels_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="05_basicmodels_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="05_basicmodels_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="05_basicmodels_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="05_basicmodels_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="05_basicmodels_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="05_basicmodels_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="05_basicmodels_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="05_basicmodels_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>