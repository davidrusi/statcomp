<!DOCTYPE html>
<html lang="en"><head>
<script src="06_computational_inference_files/libs/clipboard/clipboard.min.js"></script>
<script src="06_computational_inference_files/libs/quarto-html/tabby.min.js"></script>
<script src="06_computational_inference_files/libs/quarto-html/popper.min.js"></script>
<script src="06_computational_inference_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="06_computational_inference_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="06_computational_inference_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="06_computational_inference_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="06_computational_inference_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="author" content="David Rossell">
  <title>Modern Statistical Computing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="06_computational_inference_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="06_computational_inference_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="06_computational_inference_files/libs/revealjs/dist/theme/quarto.css">
  <link href="06_computational_inference_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="06_computational_inference_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="06_computational_inference_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="06_computational_inference_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Modern Statistical Computing</h1>
  <p class="subtitle">6. Simulation-based inference</p>
  <p class="author">David Rossell</p>
  <p class="institute">Pompeu Fabra University</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/bootstrap" id="/toc-bootstrap">Bootstrap</a></li>
<li><a href="#/exercise" id="/toc-exercise">Exercise</a></li>
<li><a href="#/permutation-tests" id="/toc-permutation-tests">Permutation tests</a></li>
<li><a href="#/exercise-1" id="/toc-exercise-1">Exercise</a></li>
</ul>
</nav>
</section>
<section id="reproducing-these-lecture-notes" class="slide level2">
<h2>Reproducing these lecture notes</h2>
<p>We load the required R packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb1-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coin)</span>
<span id="cb1-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fivethirtyeight)</span>
<span id="cb1-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmPerm)</span>
<span id="cb1-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also source routines.R, which has auxiliary functions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'../code/routines.R'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section" class="slide level2">
<h2></h2>
<p>Standard theory to obtain confidence intervals / P-values relies on assumptions</p>
<ul>
<li><p>As <span class="math inline">\(n \rightarrow \infty\)</span> some assumptions are less relevant (e.g.&nbsp;error normality)</p></li>
<li><p>Other assumptions remain critical</p></li>
</ul>
<p><strong>Example.</strong> Let <span class="math inline">\(\hat{\beta}= (X^T X)^{-1} X^T y\)</span>, where <span class="math inline">\(y \in \mathbb{R}^n\)</span>, then <span class="math display">\[
\begin{aligned}
&amp;E(\hat{\beta})= (X^T X)^{-1} X^T E(y) \\
&amp;\mbox{Cov}(\hat{\beta})= (X^T X)^{-1} X^T \mbox{Cov}(y) X (X^T X)^{-1}
\end{aligned}
\]</span></p>
<p>If we also assume that <span class="math inline">\(y= X \beta + \epsilon\)</span>, with <span class="math inline">\(\mbox{Cov}(y)= \mbox{Cov}(\epsilon)= \sigma^2 I\)</span>, then <span class="math display">\[
E(\hat{\beta})= (X^T X)^{-1} X^T X \beta= \beta; \mbox{Cov}(\hat{\beta})= \sigma^2 (X^T X)^{-1}
\]</span></p>
<p>We assumed <strong>linearity</strong> and <strong>constant variance</strong>. Else the result doesn’t hold</p>
</section>
<section>
<section id="bootstrap" class="title-slide slide level1 center">
<h1>Bootstrap</h1>

</section>
<section id="reminder-sampling-distribution" class="slide level2">
<h2>Reminder: sampling distribution</h2>
<p>Let <span class="math inline">\(\theta\)</span> be a parameter of interest, and <span class="math inline">\(\hat{\theta}=\hat{\theta}(y)\)</span> an estimator that depends on the observed data <span class="math inline">\(y\)</span>. Since <span class="math inline">\(y\)</span> is random, so is <span class="math inline">\(\hat{\theta}\)</span>.</p>
<p><strong>Def.</strong> The sampling distribution of <span class="math inline">\(\hat{\theta}\)</span> is its probability distribution under repeated sampling of <span class="math inline">\(y\)</span></p>
<p>The bootstrap (Efron, 1977) is a method to approximate the distribution of many estimators, under mild assumptions</p>
</section>
<section id="bootstrap-1" class="slide level2 scrollable">
<h2>Bootstrap</h2>
<blockquote>
<p>The sub-sample is to the sample, as the sample is to the population</p>
</blockquote>
<p>Let <span class="math inline">\((y,X)\)</span> be an <span class="math inline">\(n \times (p+1)\)</span> dataset. For <span class="math inline">\(b=1,\ldots,B\)</span> do</p>
<ol type="1">
<li><p>Sample <span class="math inline">\(n\)</span> rows with replacement from <span class="math inline">\((y,X)\)</span>, store into <span class="math inline">\((\tilde{y}^{(b)},\tilde{X}^{(b)})\)</span></p></li>
<li><p>Obtain estimator <span class="math inline">\(\tilde{\theta}^{(b)}\)</span> from <span class="math inline">\((\tilde{y}^{(b)},\tilde{X}^{(b)})\)</span></p></li>
</ol>
<p>For large <span class="math inline">\(b\)</span>, the distribution of <span class="math inline">\(\tilde{\theta}^{(b)}\)</span> approximates that of <span class="math inline">\(\hat{\theta}\)</span></p>
<p>Note: <span class="math inline">\(n\)</span> cannot be too small, and certain technical conditions on <span class="math inline">\(\hat{\theta}\)</span> are needed</p>
<p>See some <a href="https://www.stat.auckland.ac.nz/~wild/BootAnim/index.html">animations</a></p>
</section>
<section id="example.-baseball" class="slide level2">
<h2>Example. Baseball</h2>
<p>Goal: estimate batting average in major league baseball games <span class="math inline">\(\geq\)</span> 1990</p>
<ul>
<li><p>ab: number of at bats</p></li>
<li><p>h: number of hits</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a>baseball<span class="ot">=</span> baseball[baseball<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">1990</span>, ]</span>
<span id="cb3-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(baseball)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             id year stint team lg   g  ab  r   h X2b X3b hr rbi sb cs bb so
67407 aguilri01 1990     1  MIN AL  56   0  0   0   0   0  0   0  0  0  0  0
67412 alomasa02 1990     1  CLE AL 132 445 60 129  26   2  9  66  4  1 25 46
67414 anderbr01 1990     1  BAL AL  89 234 24  54   5   2  3  24 15  2 31 46
67416 anderla02 1990     2  BOS AL  15   0  0   0   0   0  0   0  0  0  0  0
67417 appieke01 1990     1  KCA AL  32   0  0   0   0   0  0   0  0  0  0  0
67422 baergca01 1990     1  CLE AL 108 312 46  81  17   2  7  47  0  2 16 57
      ibb hbp sh sf gidp
67407   0   0  0  0    0
67412   2   2  5  6   10
67414   2   5  4  5    4
67416   0   0  0  0    0
67417   0   0  0  0    0
67422   2   4  1  5    4</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Batting average is <span class="math inline">\(\theta= E(h) / E(\mbox{ab})\)</span>. Consider the estimator <span class="math display">\[
\hat{\theta}= \frac{\sum_{i=1}^n h_i}{\sum_{i=1}^n \mbox{ab}_i}  
\]</span></p>
<p>Central Limit Theorem: numerator and denominator in <span class="math inline">\(\hat{\theta}\)</span> approx. Normal as <span class="math inline">\(n \rightarrow \infty\)</span>. But <span class="math inline">\(\hat{\theta}\)</span> may not be Normal, and anyway what is it’s variance?</p>
</section>
<section id="example.-baseball-1" class="slide level2">
<h2>Example. Baseball</h2>
<p>Define a function to compute the batting average</p>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Base R</a></li><li><a href="#tabset-1-2">Tidyverse</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a>bat.avg<span class="ot">=</span> <span class="cf">function</span>(data, <span class="at">indices=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data)) {</span>
<span id="cb5-2"><a href="" aria-hidden="true" tabindex="-1"></a> <span class="fu">sum</span>(data[indices, <span class="st">"h"</span>], <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb5-3"><a href="" aria-hidden="true" tabindex="-1"></a> <span class="fu">sum</span>(data[indices, <span class="st">"ab"</span>], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-4"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">bat.avg</span>(baseball)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2729972</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a>bat.avg<span class="ot">=</span> <span class="cf">function</span>(data, <span class="at">indices=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data)) {</span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(data, indices) <span class="sc">|&gt;</span>  <span class="co">#slice is like filter, giving indices instead of logical values</span></span>
<span id="cb7-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">sum</span>(h, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(ab, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb7-5"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">bat.avg</span>(baseball)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2729972</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>For each boostrapped dataset, compute the batting average</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb9-2"><a href="" aria-hidden="true" tabindex="-1"></a>B<span class="ot">=</span> <span class="dv">2000</span>; n<span class="ot">=</span> <span class="fu">nrow</span>(baseball)</span>
<span id="cb9-3"><a href="" aria-hidden="true" tabindex="-1"></a>th<span class="ot">=</span> <span class="fu">double</span>(B)</span>
<span id="cb9-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb9-5"><a href="" aria-hidden="true" tabindex="-1"></a>  idx<span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-6"><a href="" aria-hidden="true" tabindex="-1"></a>  th[b]<span class="ot">=</span> <span class="fu">bat.avg</span>(baseball, <span class="at">indices=</span>idx)</span>
<span id="cb9-7"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example.-baseball-2" class="slide level2">
<h2>Example. Baseball</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="" aria-hidden="true" tabindex="-1"></a>ci<span class="ot">=</span> <span class="fu">quantile</span>(th, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,<span class="fl">0.975</span>)) <span class="co">#Boostrap-based 95% CI</span></span>
<span id="cb10-2"><a href="" aria-hidden="true" tabindex="-1"></a>ci</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     2.5%     97.5% 
0.2716847 0.2743102 </code></pre>
</div>
</div>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Histogram</a></li><li><a href="#tabset-2-2">qq-plot</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a>th<span class="ot">=</span> <span class="fu">tibble</span>(th)</span>
<span id="cb12-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(th, <span class="fu">aes</span>(<span class="at">x=</span>th)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span> ..density..)) <span class="sc">+</span>   </span>
<span id="cb12-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_overlay_normal_density</span>(<span class="at">linetype=</span><span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>ci)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-8-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(th, <span class="fu">aes</span>(<span class="at">sample=</span>th)) <span class="sc">+</span> <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>(<span class="at">col=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-9-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="r-functions" class="slide level2">
<h2>R functions</h2>
<p>The beauty is that the bootstrap works in more complicated settings</p>
<p>Function <code>boot</code> (package <code>boot</code>) has a generic implementation. It requires:</p>
<ul>
<li><p><code>data</code>: the dataset</p></li>
<li><p><code>statistic</code>: function to obtain <span class="math inline">\(\hat{\theta}\)</span>. Its 1st argument is the data, its 2nd argument the row indices, such as function <code>bat.avg</code> defined earlier</p></li>
<li><p><code>R</code>: number of bootstrap samples</p></li>
</ul>
<p>Further options, including parallel computing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="" aria-hidden="true" tabindex="-1"></a>avgBoot<span class="ot">=</span> <span class="fu">boot</span>(<span class="at">data=</span>baseball, <span class="at">statistic=</span>bat.avg, <span class="at">R=</span><span class="dv">2000</span>)</span>
<span id="cb14-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(avgBoot, <span class="at">conf=</span><span class="fl">0.95</span>, <span class="at">type=</span><span class="st">"basic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 2000 bootstrap replicates

CALL : 
boot.ci(boot.out = avgBoot, conf = 0.95, type = "basic")

Intervals : 
Level      Basic         
95%   ( 0.2717,  0.2743 )  
Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
</section>
<section id="regression-example" class="slide level2">
<h2>Regression example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb16-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32 11</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="" aria-hidden="true" tabindex="-1"></a>f<span class="ot">=</span> <span class="fu">formula</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> disp <span class="sc">+</span> hp <span class="sc">+</span> drat <span class="sc">+</span> wt <span class="sc">+</span> qsec <span class="sc">+</span> vs <span class="sc">+</span> am)</span>
<span id="cb18-2"><a href="" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span> <span class="fu">lm</span>(f, <span class="at">data=</span>mtcars)</span>
<span id="cb18-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  Parameter   Estimate `Conf. Int.`     `P-value`
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;    
1 (Intercept)   15.6   (-18.315,49.461) 0.35167  
2 cyl           -0.279 (-2.212,1.655)   0.76835  
3 disp           0.015 (-0.01,0.04)     0.23379  
4 hp            -0.021 (-0.055,0.012)   0.19947  
5 drat           0.815 (-2.309,3.939)   0.59456  
6 wt            -3.94  (-6.607,-1.28)   0.00551  
7 qsec           0.81  (-0.553,2.172)   0.23139  
8 vs             0.368 (-3.793,4.53)    0.85631  
9 am             2.79  (-1.071,6.659)   0.14841  </code></pre>
</div>
</div>
<p>These intervals are valid if linear model assumptions hold (linearity, constant variance, uncorrelated errors, large <span class="math inline">\(n\)</span> / normal errors)</p>
</section>
<section id="check-model-assumptions" class="slide level2">
<h2>Check model assumptions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="" aria-hidden="true" tabindex="-1"></a>mtcars.pred<span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">mpg=</span>mtcars<span class="sc">$</span>mpg, <span class="at">mpg_pred=</span> <span class="fu">predict</span>(fit)) <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res=</span> mpg <span class="sc">-</span> mpg_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Linearity</a></li><li><a href="#tabset-3-2">Error normality</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars.pred, <span class="fu">aes</span>(<span class="at">x=</span>mpg_pred, <span class="at">y=</span>res)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-14-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars.pred, <span class="fu">aes</span>(<span class="at">sample=</span>res)) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> </span>
<span id="cb22-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb22-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">'Sample quantile'</span>,<span class="at">y=</span><span class="st">'Normal quantile'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-15-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="bootstrapped-intervals" class="slide level2">
<h2>Bootstrapped intervals</h2>
<p>First, define a function to obtain <span class="math inline">\(\hat{\theta}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a>bhat<span class="ot">=</span> <span class="cf">function</span>(data, <span class="at">indices=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data), formula) {</span>
<span id="cb23-2"><a href="" aria-hidden="true" tabindex="-1"></a>  fit<span class="ot">=</span> <span class="fu">lm</span>(formula, <span class="at">data=</span>data[indices,])</span>
<span id="cb23-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">coef</span>(fit))</span>
<span id="cb23-4"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">bhat</span>(mtcars, <span class="at">formula=</span>f), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         cyl        disp          hp        drat          wt 
     15.573      -0.279       0.015      -0.021       0.815      -3.944 
       qsec          vs          am 
      0.810       0.368       2.794 </code></pre>
</div>
</div>
<p>Second, run <code>boot</code>. The bootstrap samples are in element <code>$t</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.fit<span class="ot">=</span> <span class="fu">boot</span>(mtcars, <span class="at">statistic=</span>bhat, <span class="at">R=</span><span class="dv">2000</span>, <span class="at">formula=</span>f)</span>
<span id="cb25-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(bhat.fit<span class="sc">$</span>t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2000    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(bhat.fit<span class="sc">$</span>t,<span class="dv">3</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="co">#show first five bootstrap samples</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]   [,2]  [,3]   [,4]   [,5]   [,6]  [,7]   [,8]  [,9]
[1,]  13.572 -0.265 0.007 -0.024 -0.731 -1.784 0.936 -0.505 4.106
[2,] -24.479 -0.777 0.010  0.020  3.120 -5.089 2.933 -5.412 0.161
[3,]  20.217 -0.307 0.012 -0.030  1.306 -2.352 0.259  2.189 1.862
[4,]   9.636  0.575 0.023 -0.030 -0.017 -6.477 1.400 -0.764 4.611
[5,]   6.420 -0.899 0.040 -0.018 -1.012 -7.243 2.153 -3.090 5.380</code></pre>
</div>
</div>
<p>The estimate for the original data is in element <code>$t0</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(bhat.fit<span class="sc">$</span>t0, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         cyl        disp          hp        drat          wt 
     15.573      -0.279       0.015      -0.021       0.815      -3.944 
       qsec          vs          am 
      0.810       0.368       2.794 </code></pre>
</div>
</div>
</section>
<section id="sampling-distribution-of-hattheta" class="slide level2">
<h2>Sampling distribution of <span class="math inline">\(\hat{\theta}\)</span></h2>
<p>Format the data into a long tibble, so we can use faceting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(bhat.fit<span class="sc">$</span>t)<span class="ot">=</span> <span class="fu">names</span>(bhat.fit<span class="sc">$</span>t0)</span>
<span id="cb31-2"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.boot<span class="ot">=</span> <span class="fu">as_tibble</span>(bhat.fit<span class="sc">$</span>t)</span>
<span id="cb31-3"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.boot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 × 9
   `(Intercept)`    cyl    disp        hp    drat    wt  qsec     vs     am
           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1         13.6  -0.265 0.00737 -0.0244   -0.731  -1.78 0.936 -0.505  4.11 
 2        -24.5  -0.777 0.00986  0.0197    3.12   -5.09 2.93  -5.41   0.161
 3         20.2  -0.307 0.0124  -0.0303    1.31   -2.35 0.259  2.19   1.86 
 4          9.64  0.575 0.0227  -0.0298   -0.0175 -6.48 1.40  -0.764  4.61 
 5          6.42 -0.899 0.0403  -0.0185   -1.01   -7.24 2.15  -3.09   5.38 
 6          4.40  0.225 0.0226  -0.0130    1.86   -5.22 1.06   1.27   3.16 
 7          4.08 -0.902 0.0123  -0.0103    0.866  -3.46 1.58  -2.42   3.73 
 8         29.8  -2.19  0.0209  -0.000674  1.20   -4.47 0.588 -1.31  -1.16 
 9        -22.7   1.56  0.0189  -0.0351    4.76   -3.70 1.44   0.975  6.87 
10         13.2  -0.223 0.0256  -0.0194    0.779  -5.59 1.04   0.721  2.84 
# ℹ 1,990 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.bootlong<span class="ot">=</span> <span class="fu">pivot_longer</span>(bhat.boot, <span class="at">cols=</span> <span class="fu">names</span>(bhat.boot), <span class="at">names_to=</span><span class="st">"variable"</span>, <span class="at">values_to=</span><span class="st">"bootstrap_value"</span>)</span>
<span id="cb33-2"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.bootlong</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,000 × 2
   variable    bootstrap_value
   &lt;chr&gt;                 &lt;dbl&gt;
 1 (Intercept)        13.6    
 2 cyl                -0.265  
 3 disp                0.00737
 4 hp                 -0.0244 
 5 drat               -0.731  
 6 wt                 -1.78   
 7 qsec                0.936  
 8 vs                 -0.505  
 9 am                  4.11   
10 (Intercept)       -24.5    
# ℹ 17,990 more rows</code></pre>
</div>
</div>
</section>
<section id="sampling-distribution-of-hattheta-1" class="slide level2">
<h2>Sampling distribution of <span class="math inline">\(\hat{\theta}\)</span></h2>
<p>There are deviations from normality. Set <code>scales="free"</code> so that each panel uses different axis limits</p>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">qq-plot</a></li><li><a href="#tabset-4-2">Histogram</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bhat.bootlong, <span class="fu">aes</span>(<span class="at">sample=</span>bootstrap_value)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> </span>
<span id="cb35-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>(<span class="at">col=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb35-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales=</span><span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-21-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bhat.bootlong, <span class="fu">aes</span>(<span class="at">x=</span>bootstrap_value)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span> ..density..)) <span class="sc">+</span></span>
<span id="cb36-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_overlay_normal_density</span>(<span class="at">linetype=</span><span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales=</span><span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-22-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="bootstrap-intervals" class="slide level2">
<h2>Bootstrap intervals</h2>
<p>Compare bootstrap intervals vs.&nbsp;least-squares theory</p>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Bootstrap</a></li><li><a href="#tabset-5-2">Least-squares theory</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#map_df gets quantiles for all columns, returns a data frame (tibble)</span></span>
<span id="cb37-2"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.ci<span class="ot">=</span> <span class="fu">map_df</span>(bhat.boot, quantile, <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-3"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.ci<span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">varname=</span> <span class="fu">names</span>(bhat.boot), <span class="fu">round</span>(bhat.ci,<span class="dv">4</span>)) </span>
<span id="cb37-4"><a href="" aria-hidden="true" tabindex="-1"></a>bhat.ci</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      varname     2.5%   97.5%
1 (Intercept) -48.3929 49.3768
2         cyl  -2.2716  2.1297
3        disp  -0.0073  0.0373
4          hp  -0.0570  0.0340
5        drat  -1.7832  5.1810
6          wt  -7.4392 -1.2724
7        qsec  -0.6155  3.5710
8          vs  -5.9732  4.1394
9          am  -1.6513  7.1079</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  Parameter   Estimate `Conf. Int.`     `P-value`
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;    
1 (Intercept)   15.6   (-18.315,49.461) 0.35167  
2 cyl           -0.279 (-2.212,1.655)   0.76835  
3 disp           0.015 (-0.01,0.04)     0.23379  
4 hp            -0.021 (-0.055,0.012)   0.19947  
5 drat           0.815 (-2.309,3.939)   0.59456  
6 wt            -3.94  (-6.607,-1.28)   0.00551  
7 qsec           0.81  (-0.553,2.172)   0.23139  
8 vs             0.368 (-3.793,4.53)    0.85631  
9 am             2.79  (-1.071,6.659)   0.14841  </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Let’s plot the intervals for easier comparison</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="" aria-hidden="true" tabindex="-1"></a>yvals<span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">coef</span>(fit))</span>
<span id="cb41-2"><a href="" aria-hidden="true" tabindex="-1"></a>ci<span class="ot">=</span> <span class="fu">cbind</span>(bhat.ci, <span class="fu">confint</span>(fit), <span class="at">y.ols=</span>yvals, <span class="at">y.boot=</span>yvals<span class="fl">+.1</span>)</span>
<span id="cb41-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ci)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'varname'</span>,<span class="st">'low.boot'</span>,<span class="st">'high.boot'</span>,<span class="st">'low.ols'</span>,<span class="st">'high.ols'</span>,<span class="st">'y.ols'</span>,<span class="st">'y.boot'</span>)</span>
<span id="cb41-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci) <span class="sc">+</span> </span>
<span id="cb41-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>low.ols,<span class="at">xend=</span>high.ols,<span class="at">y=</span>y.ols,<span class="at">yend=</span>y.ols)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>low.boot,<span class="at">xend=</span>high.boot,<span class="at">y=</span>y.boot,<span class="at">yend=</span>y.boot), <span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb41-7"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>low.ols, <span class="at">y=</span>y.ols, <span class="at">label=</span>varname), <span class="at">nudge_y =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">'Confidence interval'</span>, <span class="at">y=</span><span class="st">''</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),  <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>()) <span class="co">#remove y axis labels </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-25-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="exercise" class="title-slide slide level1 center">
<h1>Exercise</h1>

</section>
<section class="slide level2">

<p>Data <code>hate_crimes</code>. Outcome: pre-election number of hate crimes per 100,000 population by the FBI</p>
<ul>
<li><p>education (% adults <span class="math inline">\(\geq\)</span> 25 with high school degree)</p></li>
<li><p>% of people who voted Donald Trump</p></li>
<li><p>Income inequality (Gini index)</p></li>
</ul>
<p>In these data the linearity assumption is violated.</p>
<p>Compare the intervals reported by <code>lm</code> to those from bootstrap</p>
<p>Turn in an html with your solution at Aula Global Name your file firstname_lastname.html</p>
</section>
<section class="slide level2">

<p>Load packages and format data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb42-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb42-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fivethirtyeight)</span>
<span id="cb42-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmPerm)</span>
<span id="cb42-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/github/statcomp/code/routines.R"</span>)</span>
<span id="cb42-6"><a href="" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'state_abbrev'</span>,<span class="st">'avg_hatecrimes_per_100k_fbi'</span>,<span class="st">'share_vote_trump'</span>,<span class="st">'gini_index'</span>,<span class="st">'share_pop_hs'</span>)</span>
<span id="cb42-7"><a href="" aria-hidden="true" tabindex="-1"></a>hc<span class="ot">=</span> hate_crimes[,sel]</span>
<span id="cb42-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'state'</span>,<span class="st">'hatecrimes_fbi'</span>,<span class="st">'votes_trump'</span>,<span class="st">'gini'</span>,<span class="st">'hs'</span>)</span>
<span id="cb42-9"><a href="" aria-hidden="true" tabindex="-1"></a>hc<span class="ot">=</span> <span class="fu">filter</span>(hc, <span class="sc">!</span><span class="fu">is.na</span>(hatecrimes_fbi)) <span class="co">#outcome must be non-missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model is fit by least-squares as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span> <span class="fu">lm</span>(hatecrimes_fbi <span class="sc">~</span> votes_trump <span class="sc">+</span> gini <span class="sc">+</span> hs, <span class="at">data=</span>hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="permutation-tests" class="title-slide slide level1 center">
<h1>Permutation tests</h1>

</section>
<section id="permutation-tests-1" class="slide level2">
<h2>Permutation tests</h2>
<p>A strategy to test a null hypothesis without relying on parametric assumptions (normality etc.)</p>
<p>We consider two uses</p>
<ul>
<li><p>Compare a mean/median/proportion across groups</p></li>
<li><p>Assess significance of a regression coefficient</p></li>
</ul>
</section>
<section id="group-comparisons" class="slide level2 scrollable">
<h2>Group comparisons</h2>
<p>Let <span class="math inline">\(y_i\)</span> be outcome, <span class="math inline">\(x_i \in \{1,\ldots,K\}\)</span> a group indicator, <span class="math inline">\(\mu_k= E(y_i \mid x_i=k)\)</span> the expectation in each group</p>
<p><span class="math display">\[H_0: \mu_1= \mu_2= \ldots = \mu_K\]</span></p>
<p>General recipe to obtain a P-value</p>
<ol type="1">
<li><p>Define a test statistic <span class="math inline">\(T\)</span> to measure evidence against <span class="math inline">\(H_0\)</span></p></li>
<li><p>Compute its value in the observed data, denote by <span class="math inline">\(t\)</span></p></li>
<li><p>Compare <span class="math inline">\(t\)</span> to the distribution of <span class="math inline">\(T\)</span> if <span class="math inline">\(H_0\)</span> were true</p></li>
</ol>
<p><span class="math display">\[
\mbox{P-value}= P(T \geq t \mid H_0)
\]</span></p>
<p><strong>Idea:</strong> if <span class="math inline">\(y_i\)</span> indep. of <span class="math inline">\(x_i\)</span> (so <span class="math inline">\(H_0\)</span> true) we can permute <span class="math inline">\(x_i\)</span> without altering the distribution of <span class="math inline">\((y_i,x_i)\)</span></p>
</section>
<section class="slide level2">

<p>Formally, <span class="math inline">\(H_0: P(y_i, x_i)= P(y_i) P(x_i)\)</span>. Define test statistic <span class="math inline">\(T\)</span> that targets our original <span class="math inline">\(H_0\)</span> (mean comparison), for example</p>
<p><span class="math display">\[
T= \sum_{k=1}^K (\bar{y}_k - \bar{y})^2
\]</span></p>
<p><strong>Example.</strong> <span class="math inline">\(n=24\)</span> mice, 12 receive a muscle relaxant and 12 placebo. We measure the time (up to 300 sec) that they run in a mill</p>
</section>
<section id="mouse-data" class="slide level2">
<h2>Mouse data</h2>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">Data</a></li><li><a href="#tabset-6-2">Scatter plot</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="" aria-hidden="true" tabindex="-1"></a>rotarod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   time     group
1   300   control
2   300   control
3   300   control
4   300   control
5   300   control
6   300   control
7   300   control
8   300   control
9   300   control
10  300   control
11  300   control
12  300   control
13   22 treatment
14  300 treatment
15   75 treatment
16  271 treatment
17  300 treatment
18   18 treatment
19  300 treatment
20  300 treatment
21  163 treatment
22  300 treatment
23  300 treatment
24  300 treatment</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rotarod, <span class="fu">aes</span>(group, time)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-30-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="permutation-test" class="slide level2">
<h2>Permutation test</h2>
<p>First, define function to compute test statistic</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="" aria-hidden="true" tabindex="-1"></a>tstat<span class="ot">=</span> <span class="cf">function</span>(data) {</span>
<span id="cb47-2"><a href="" aria-hidden="true" tabindex="-1"></a>  xbar<span class="ot">=</span> <span class="fu">aggregate</span>(time <span class="sc">~</span> group, <span class="at">data=</span>data, <span class="at">FUN=</span>mean)</span>
<span id="cb47-3"><a href="" aria-hidden="true" tabindex="-1"></a>  ans<span class="ot">=</span> <span class="fu">sum</span>((xbar<span class="sc">$</span>time <span class="sc">-</span> <span class="fu">mean</span>(xbar<span class="sc">$</span>time))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb47-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ans)</span>
<span id="cb47-5"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Second, obtain test statistic for the observed data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="" aria-hidden="true" tabindex="-1"></a>tobs<span class="ot">=</span> <span class="fu">tstat</span>(rotarod)</span>
<span id="cb48-2"><a href="" aria-hidden="true" tabindex="-1"></a>tobs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3140.281</code></pre>
</div>
</div>
<p>Finally, obtain test stat under permuted data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="" aria-hidden="true" tabindex="-1"></a>B<span class="ot">=</span> <span class="dv">2000</span>; n<span class="ot">=</span> <span class="fu">nrow</span>(rotarod)</span>
<span id="cb50-2"><a href="" aria-hidden="true" tabindex="-1"></a>t0<span class="ot">=</span> <span class="fu">double</span>(B)</span>
<span id="cb50-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb50-4"><a href="" aria-hidden="true" tabindex="-1"></a>  groupperm<span class="ot">=</span> rotarod<span class="sc">$</span>group[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">FALSE</span>)]</span>
<span id="cb50-5"><a href="" aria-hidden="true" tabindex="-1"></a>  dataperm<span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">time=</span>rotarod<span class="sc">$</span>time, <span class="at">group=</span>groupperm)</span>
<span id="cb50-6"><a href="" aria-hidden="true" tabindex="-1"></a>  t0[b]<span class="ot">=</span> <span class="fu">tstat</span>(dataperm)</span>
<span id="cb50-7"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distribution-under-h_0" class="slide level2">
<h2>Distribution under <span class="math inline">\(H_0\)</span></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue<span class="ot">=</span> <span class="fu">mean</span>(t0 <span class="sc">&gt;=</span> tobs) <span class="co">#proportion of t0's &gt;= tobs </span></span>
<span id="cb51-2"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.039</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t0,<span class="at">main=</span><span class="st">''</span>,<span class="at">xlab=</span><span class="st">'Test statistic'</span>); <span class="fu">abline</span>(<span class="at">v=</span> tobs, <span class="at">col=</span><span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="06_computational_inference_files/figure-revealjs/unnamed-chunk-34-1.png" width="960" class="r-stretch"></section>
<section id="r-package-coin" class="slide level2">
<h2>R package coin</h2>
<p><code>coin</code> implements permutation tests (with additional options)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#based on asymptotic theory</span></span>
<span id="cb54-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">independence_test</span>(time <span class="sc">~</span> group, <span class="at">data=</span>rotarod, <span class="at">teststat=</span><span class="st">"quadratic"</span>, <span class="at">distribution=</span><span class="st">"asymptotic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic General Independence Test

data:  time by group (control, treatment)
chi-squared = 4.5771, df = 1, p-value = 0.0324</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#permutation-based</span></span>
<span id="cb56-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">independence_test</span>(time <span class="sc">~</span> group, <span class="at">data=</span>rotarod, <span class="at">teststat=</span><span class="st">"quadratic"</span>, <span class="at">distribution=</span><span class="st">"approximate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Approximative General Independence Test

data:  time by group (control, treatment)
chi-squared = 4.5771, p-value = 0.0344</code></pre>
</div>
</div>
</section>
<section id="permutation-tests-in-regression" class="slide level2">
<h2>Permutation tests in regression</h2>
<p>Permutation tests also apply if <span class="math inline">\(x_i \in \mathbb{R}\)</span> is a continuous covariate</p>
<p>With <span class="math inline">\(p&gt;1\)</span> covariates however, some care is needed</p>
<p><strong>Example.</strong> Does murder rate (per 100,000 population) depend on population, after accounting for literacy, income, and number of days below freezing temperature?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="" aria-hidden="true" tabindex="-1"></a>states<span class="ot">=</span> <span class="fu">as.data.frame</span>(state.x77) <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(Murder, Population, Illiteracy, Income, Frost) <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>Murder, scale)) <span class="co">#standardize all vars except Murder to mean 0, variance 1</span></span>
<span id="cb58-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">=</span> <span class="fu">lm</span>(Murder<span class="sc">~</span>Population <span class="sc">+</span> Illiteracy<span class="sc">+</span>Income<span class="sc">+</span>Frost, <span class="at">data=</span>states)</span>
<span id="cb58-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  Parameter   Estimate `Conf. Int.`   `P-value`
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    
1 (Intercept)    1.24  (-6.552,9.021) 0.75095  
2 Population     0     (0,0)          0.01732  
3 Illiteracy     4.14  (2.382,5.904)  2e-05    
4 Income         0     (-0.001,0.001) 0.92534  
5 Frost          0.001 (-0.02,0.021)  0.95415  </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Package <code>lmPerm</code> offers a permutation test for regression</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span> <span class="fu">lmp</span>(Murder <span class="sc">~</span> Population <span class="sc">+</span> Illiteracy <span class="sc">+</span> Income <span class="sc">+</span> Frost, <span class="at">data=</span>states)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Settings:  unique SS : numeric variables centered"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lmp(formula = Murder ~ Population + Illiteracy + Income + Frost, 
    data = states)

Residuals:
     Min       1Q   Median       3Q      Max 
-4.79597 -1.64946 -0.08112  1.48150  7.62104 

Coefficients:
            Estimate Iter Pr(Prob)    
Population 2.237e-04   51    1.000    
Illiteracy 4.143e+00 5000   &lt;2e-16 ***
Income     6.442e-05   51    0.882    
Frost      5.813e-04   51    0.961    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.535 on 45 degrees of freedom
Multiple R-Squared: 0.567,  Adjusted R-squared: 0.5285 
F-statistic: 14.73 on 4 and 45 DF,  p-value: 9.133e-08 </code></pre>
</div>
</div>
</section>
<section id="permutations-in-regression" class="slide level2">
<h2>Permutations in regression</h2>
<p>To assess significance of <span class="math inline">\(x_1\)</span> in regression, it is <strong>incorrect</strong> to simply permute <span class="math inline">\(x_1\)</span></p>
<p>If we only permute <span class="math inline">\(x_1\)</span>, the null hypothesis is</p>
<p><span class="math display">\[P(y | x_{1}, x_{2})= P(y \mid x_{2}) \mbox{ and }  P(x_{1}, x_{2})= P(x_{1}) P(x_{2})\]</span> but we just wanted to test <span class="math inline">\(P(y | x_{1}, x_{})= P(y_i \mid x_{2})\)</span>, i.e.&nbsp;<span class="math inline">\((x_1,x_2)\)</span> are not independent!</p>
<p>Residual permutation (used by <code>lmPerm</code>) is a way to address this</p>
</section>
<section id="residual-permutation" class="slide level2 scrollable">
<h2>Residual permutation</h2>
<p>Idea: replace <span class="math inline">\(x_1\)</span> by a permuted version <span class="math inline">\(\tilde{x}_1\)</span> that is correlated with <span class="math inline">\(x_2\)</span></p>
<ol type="1">
<li><p>Regress <span class="math inline">\(x_1\)</span> on <span class="math inline">\(x_2\)</span> by OLS. Let <span class="math inline">\(\hat{x}_{i1}\)</span> be the predictions, <span class="math inline">\(e_i\)</span> the residuals</p></li>
<li><p>For <span class="math inline">\(b=1,\ldots,B\)</span>, do</p></li>
</ol>
<ul>
<li><p>Permute <span class="math inline">\((e_1,\ldots,e_n)\)</span> into <span class="math inline">\((\tilde{e}_1^{(b)}, \ldots \tilde{e}_n^{(b)})\)</span></p></li>
<li><p>Let <span class="math inline">\(\tilde{x}_{i1}^{(b)}= \hat{x}_{i1} + \tilde{e}_i^{(b)}\)</span></p></li>
<li><p>Let <span class="math inline">\(\tilde{\beta}^{(b)}\)</span> be regression estimate of <span class="math inline">\(y\)</span> on <span class="math inline">\((\tilde{x}_1,x_2)\)</span></p></li>
</ul>
<p>By construction <span class="math inline">\(\mbox{cor}(\tilde{x}_1,x_2) \approx \mbox{cor}(x_1, x_2)\)</span>. But given <span class="math inline">\(\hat{x}_1\)</span> (i.e.&nbsp;given <span class="math inline">\(x_2\)</span>), <span class="math inline">\(\tilde{x}_1\)</span> is independent of <span class="math inline">\(y\)</span></p>
</section>
<section class="slide level2">

<p>Define an R function (saved in routines.R)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#Residual permutation test for a single variable in linear regression</span></span>
<span id="cb64-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#Input</span></span>
<span id="cb64-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># - y: outcome</span></span>
<span id="cb64-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># - x1: covariate of interest</span></span>
<span id="cb64-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># - x2: other covariates</span></span>
<span id="cb64-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># - B: number of residual permutations to consider</span></span>
<span id="cb64-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: estimated coefficients for x1 in the B permutations</span></span>
<span id="cb64-8"><a href="" aria-hidden="true" tabindex="-1"></a>lmResPerm.onevar<span class="ot">=</span> <span class="cf">function</span>(y, x1, x2, <span class="at">B=</span><span class="dv">5000</span>) {</span>
<span id="cb64-9"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.matrix</span>(x2)) x2<span class="ot">=</span> <span class="fu">as.matrix</span>(x2)</span>
<span id="cb64-10"><a href="" aria-hidden="true" tabindex="-1"></a>  fit<span class="ot">=</span> <span class="fu">lm</span>(x1 <span class="sc">~</span> x2)</span>
<span id="cb64-11"><a href="" aria-hidden="true" tabindex="-1"></a>  x1hat<span class="ot">=</span> <span class="fu">predict</span>(fit)</span>
<span id="cb64-12"><a href="" aria-hidden="true" tabindex="-1"></a>  e<span class="ot">=</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb64-13"><a href="" aria-hidden="true" tabindex="-1"></a>  bperm<span class="ot">=</span> <span class="fu">double</span>(B)</span>
<span id="cb64-14"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb64-15"><a href="" aria-hidden="true" tabindex="-1"></a>    eperm<span class="ot">=</span> <span class="fu">sample</span>(e, <span class="at">size=</span><span class="fu">length</span>(e), <span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-16"><a href="" aria-hidden="true" tabindex="-1"></a>    x1tilde<span class="ot">=</span> x1hat <span class="sc">+</span> eperm</span>
<span id="cb64-17"><a href="" aria-hidden="true" tabindex="-1"></a>    fitperm<span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1tilde <span class="sc">+</span> x2)</span>
<span id="cb64-18"><a href="" aria-hidden="true" tabindex="-1"></a>    bperm[b]<span class="ot">=</span> <span class="fu">coef</span>(fitperm)[<span class="st">'x1tilde'</span>]    </span>
<span id="cb64-19"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-20"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(bperm)  </span>
<span id="cb64-21"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Obtain a residual permutation P-value for Population</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span> states<span class="sc">$</span>Murder; x1<span class="ot">=</span> states<span class="sc">$</span>Population; x2<span class="ot">=</span> states[,<span class="fu">c</span>(<span class="st">'Illiteracy'</span>,<span class="st">'Income'</span>,<span class="st">'Frost'</span>)]</span>
<span id="cb65-2"><a href="" aria-hidden="true" tabindex="-1"></a>bperm<span class="ot">=</span> <span class="fu">lmResPerm.onevar</span>(y, x1, x2, <span class="at">B=</span><span class="dv">5000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="" aria-hidden="true" tabindex="-1"></a>bobs<span class="ot">=</span> <span class="fu">coef</span>(fit1)[<span class="st">'Population'</span>]</span>
<span id="cb66-2"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue<span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(bperm) <span class="sc">&gt;</span> <span class="fu">abs</span>(bobs))</span>
<span id="cb66-3"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.021</code></pre>
</div>
</div>
<p>Now for all covariates (<code>lmResPerm</code> is in routines.R)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">Population=</span>x1, x2)</span>
<span id="cb68-2"><a href="" aria-hidden="true" tabindex="-1"></a>fit1.resperm<span class="ot">=</span> <span class="fu">lmResPerm</span>(y, x, <span class="at">B=</span><span class="dv">5000</span>)</span>
<span id="cb68-3"><a href="" aria-hidden="true" tabindex="-1"></a>fit1.resperm<span class="sc">$</span>pvalue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Population Illiteracy     Income      Frost 
    0.0218     0.0000     0.9288     0.9530 </code></pre>
</div>
</div>
<p>Recall the results from package <code>lmPerm</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Iter   Pr(Prob)
(Intercept) 7.37800000 5000 0.00000000
Population  0.99859672 4864 0.02014803
Illiteracy  2.52519607 5000 0.00000000
Income      0.03958704   51 0.88235294
Frost       0.03021675   51 0.96078431</code></pre>
</div>
</div>
</section>
<section id="final-remarks" class="slide level2">
<h2>Final remarks</h2>
<p>Bootstrap is more popular than permutation: if we have CIs, we can also test the null hypothesis</p>
<p>Example: test <span class="math inline">\(H_0: \theta=0\)</span>.</p>
<ul>
<li><p>If a 95% CI for <span class="math inline">\(\theta\)</span> doesn’t include 0, then P-value<span class="math inline">\(\leq 0.05\)</span></p></li>
<li><p>If a 99% CI doesn’t include 0, then P-value<span class="math inline">\(\leq 0.01\)</span>.</p></li>
</ul>
<p>Let <span class="math inline">\((1-\alpha)\)</span>% be the largest CI that doesn’t include 0. Then P-value<span class="math inline">\(=\alpha\)</span></p>
<p>Dependent data: bootstrap needs to be adjusted (model-based bootstrap, block-based bootstrap…). See package <code>boot</code></p>
</section></section>
<section>
<section id="exercise-1" class="title-slide slide level1 center">
<h1>Exercise</h1>

</section>
<section class="slide level2 scrollable">

<p>Data <code>hate_crimes</code>. Outcome: pre-election number of hate crimes per 100,000 population by the FBI</p>
<ul>
<li><p>education (% adults <span class="math inline">\(\geq\)</span> 25 with high school degree)</p></li>
<li><p>% of people who voted Donald Trump</p></li>
<li><p>Income inequality (Gini index)</p></li>
</ul>
<p>In these data the linearity assumption is violated.</p>
<ol type="1">
<li><p>Use bootstrap to assess whether the distribution of <span class="math inline">\(\hat{\beta}\)</span> is approximately normal. For example, for each covariate <span class="math inline">\(j\)</span>, obtain qq-normal plots for the <span class="math inline">\(B\)</span> bootstrap estimates <span class="math inline">\(\hat{\beta}_j^{(1)},\ldots,\hat{\beta}_j^{(B)}\)</span></p></li>
<li><p>Compare the permutation test P-values to those from <code>lm</code></p></li>
</ol>
</section>
<section class="slide level2">

<p>Load packages and format data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb72-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb72-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fivethirtyeight)</span>
<span id="cb72-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmPerm)</span>
<span id="cb72-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/github/statcomp/code/routines.R"</span>)</span>
<span id="cb72-6"><a href="" aria-hidden="true" tabindex="-1"></a>sel<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'state_abbrev'</span>,<span class="st">'avg_hatecrimes_per_100k_fbi'</span>,<span class="st">'share_vote_trump'</span>,<span class="st">'gini_index'</span>,<span class="st">'share_pop_hs'</span>)</span>
<span id="cb72-7"><a href="" aria-hidden="true" tabindex="-1"></a>hc<span class="ot">=</span> hate_crimes[,sel]</span>
<span id="cb72-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'state'</span>,<span class="st">'hatecrimes_fbi'</span>,<span class="st">'votes_trump'</span>,<span class="st">'gini'</span>,<span class="st">'hs'</span>)</span>
<span id="cb72-9"><a href="" aria-hidden="true" tabindex="-1"></a>hc<span class="ot">=</span> <span class="fu">filter</span>(hc, <span class="sc">!</span><span class="fu">is.na</span>(hatecrimes_fbi)) <span class="co">#outcome must be non-missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model is fit by least-squares as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span> <span class="fu">lm</span>(hatecrimes_fbi <span class="sc">~</span> votes_trump <span class="sc">+</span> gini <span class="sc">+</span> hs, <span class="at">data=</span>hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="06_computational_inference_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="06_computational_inference_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="06_computational_inference_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="06_computational_inference_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="06_computational_inference_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="06_computational_inference_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="06_computational_inference_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="06_computational_inference_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="06_computational_inference_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="06_computational_inference_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>